!function(){"use strict";var f=self,e=f.WebSharper=f.WebSharper||{},t=e.Forms=e.Forms||{},n=t.Bootstrap=t.Bootstrap||{},T=n.Controls=n.Controls||{},r=T.Simple=T.Simple||{},o=f.StartupCode$Tahoe_Web$BootstrapForms=f.StartupCode$Tahoe_Web$BootstrapForms||{},i=f.Tahoe=f.Tahoe||{},u=i.Web=i.Web||{},d=u.IPv4=u.IPv4||{},p=d.CIDR=d.CIDR||{},a=u.Strings=u.Strings||{},m=u.WireguardCrypto=u.WireguardCrypto||{},l=f.StartupCode$Tahoe_Web$Crypto=f.StartupCode$Tahoe_Web$Crypto||{},y=u.Wireguard=u.Wireguard||{},E=y.Interface=y.Interface||{},g=y.Peer=y.Peer||{},C=y.Config=y.Config||{},$=u.Validation=u.Validation||{},v=u.FormHelpers=u.FormHelpers||{},c=f.StartupCode$Tahoe_Web$FormHelpers=f.StartupCode$Tahoe_Web$FormHelpers||{},h=u.Shared=u.Shared||{},n=u.ConfigGeneratorPage=u.ConfigGeneratorPage||{},I=n.FormResult=n.FormResult||{},s=u.QrCodeGeneratorPage=u.QrCodeGeneratorPage||{},w=f.StartupCode$Tahoe_Web$QrCodeGeneratorPage=f.StartupCode$Tahoe_Web$QrCodeGeneratorPage||{},P=e&&e.List,S=t&&t.Doc,i=e&&e.UI,b=i&&i.Doc,A=e&&e.Seq,u=f.IntelliFactory,N=u&&u.Runtime,R=t&&t.View,x=i&&i.View,u=f.System,D=u&&u.Guid,M=i&&i.AttrModule,W=i&&i.AttrProxy,B=e&&e.Operators,_=e&&e.Arrays,L=e&&e.Utils,G=e&&e.Option,U=t&&t.Form,k=t&&t.Validation,F=e&&e.Numeric,K=e&&e.Concurrency,u=e&&e.Remoting,O=u&&u.AjaxRemotingProvider,V=i&&i.Var$1,Q=t&&t.Pervasives,j=e&&e.Unchecked,e=e&&e.JavaScript,q=e&&e.Promise,Y=f.Math;r.ShowErrors=function(e){return T.ShowErrors([],e)},r.Button=function(e,t){return e=e,T.Button()(e)(P.ofArray([T.cls()("button btn-primary")]))(t)},r.Checkbox=function(e,t){return T.Checkbox(e,P.T.Empty,t,[],[])},r.TextAreaWithError=function(e,t,n){var r,o=T.TextAreaWithError(e);return e=P.T.Empty,r=o(e),function(e){return r([e[0],e[1],e[2]])}([t,P.T.Empty,P.T.Empty])(n)},r.TextArea=function(e,t){return T.TextArea(e,P.T.Empty,t,[],P.T.Empty)},r.InputPasswordWithError=function(e,t,n){var r,o=T.InputPasswordWithError(e);return e=P.T.Empty,r=o(e),function(e){return r([e[0],e[1],e[2]])}([t,P.T.Empty,P.T.Empty])(n)},r.InputPassword=function(e,t){return T.InputPassword(e,P.T.Empty,t,[],P.T.Empty)},r.InputWithError=function(e,t,n){var r,o=T.InputWithError(e);return e=P.T.Empty,r=o(e),function(e){return r([e[0],e[1],e[2]])}([t,P.T.Empty,P.T.Empty])(n)},r.Input=function(e,t){return T.Input(e,P.T.Empty,t,[],P.T.Empty)},T.ShowErrors=function(t,e){return S.ShowErrors(e,function(e){return 0==e.$?b.get_Empty():b.Element("div",t,[b.Element("div",P.ofArray([T.cls()("alert alert-danger")]),A.map(function(e){return b.Element("p",[],[b.TextNode(e.message)])},e))])})},T.Button=function(){return o.$cctor(),o.Button},T.TextAreaWithError=N.Curried3(function(t,n,e){var r=e[0],o=e[1],i=e[2];return function(e){return T.__InputWithError(b.InputArea,t,n,r,o,i,e)}}),T.InputPasswordWithError=N.Curried3(function(t,n,e){var r=e[0],o=e[1],i=e[2];return function(e){return T.__InputWithError(b.PasswordBox,t,n,r,o,i,e)}}),T.InputWithError=N.Curried3(function(t,n,e){var r=e[0],o=e[1],i=e[2];return function(e){return T.__InputWithError(b.Input,t,n,r,o,i,e)}}),T.__InputWithError=function(e,t,n,r,o,i,u){var a=R.Through$1(u,r),l=x.Map(function(e){return 1!=e.$||0!=e.$0.$},a),u=x.Map(function(e){return 1==e.$&&1==e.$0.$},a),c=x.Map(function(e){var t;return 1!=e.$||(0==e.$0.$||(t=e.$0,0))?null:{$:1,$0:P.reduce(function(e,t){return e+"; "+t},P.map(function(e){return e.message},t))}},a),a=D.NewGuid(),s=f.String(a),a=x.Map2(function(e,t){return e&&!t},l,u),u=x.Map2(function(e,t){return e&&t},l,u),d=P.ofArray([M.DynamicClassPred("is-valid",a),M.DynamicClassPred("is-invalid",u)]);return b.Element("div",P.ofSeq(A.delay(function(){return A.append([T.cls()("form-group")],A.delay(function(){return n}))})),P.ofSeq(A.delay(function(){return A.append([b.Element("label",new P.T({$:1,$0:W.Create("for",s),$1:o}),[b.TextNode(t)])],A.delay(function(){return A.append([e(P.append(new P.T({$:1,$0:T.cls()("form-control"),$1:new P.T({$:1,$0:W.Create("id",s),$1:i})}),d),r)],A.delay(function(){return[b.BindView(function(e){return null!=e&&1==e.$?b.Element("div",[T.cls()("invalid-feedback")],[b.TextNode(e.$0)]):b.get_Empty()},c)]}))}))})))},T.Radio=function(e,t,n,r,o){return b.Element("div",new P.T({$:1,$0:T.cls()("radio"),$1:t}),[b.Element("label",r,[b.Radio(o,!0,n),b.TextNode(e)])])},T.Checkbox=function(e,t,n,r,o){return b.Element("div",new P.T({$:1,$0:T.cls()("checkbox"),$1:t}),[b.Element("label",r,[b.CheckBox(o,n),b.TextNode(e)])])},T.TextArea=function(e,t,n,r,o){return b.Element("div",new P.T({$:1,$0:T.cls()("form-group"),$1:t}),[b.Element("label",r,[b.TextNode(e)]),b.InputArea(new P.T({$:1,$0:T.cls()("form-control"),$1:o}),n)])},T.InputPassword=function(e,t,n,r,o){return b.Element("div",new P.T({$:1,$0:T.cls()("form-group"),$1:t}),[b.Element("label",r,[b.TextNode(e)]),b.PasswordBox(new P.T({$:1,$0:T.cls()("form-control"),$1:o}),n)])},T.Input=function(e,t,n,r,o){return b.Element("div",new P.T({$:1,$0:T.cls()("form-group"),$1:t}),[b.Element("label",r,[b.TextNode(e)]),b.Input(new P.T({$:1,$0:T.cls()("form-control"),$1:o}),n)])},T.Class=function(){return o.$cctor(),o.Class},T.cls=function(){return o.$cctor(),o.cls},o.$cctor=function(){o.$cctor=f.ignore,o.cls=M.Class,o.Class=M.Class,o.Button=N.Curried3(b.Button)},(p=d.CIDR=N.Class({toString:function(){var e=this.Address;return N.Curried(function(e,t,n,r,o,i){return e(f.String(t)+"."+f.String(n)+"."+f.String(r)+"."+f.String(o)+"/"+f.String(i))},6)(f.id)(e[0])(e[1])(e[2])(e[3])(this.BitmaskLength)}},null,p)).New=function(e,t){return new p({Address:e,BitmaskLength:t})},d.generateIpsFromCidr=function(e){var t,n,r=e.Address[3],o=e.Address[2],i=e.BitmaskLength,u=e.Address[1],e=e.Address[0];return d.isValidCidr(p.New([e,u,o,r],i))||B.FailWith("Invalid CIDR"),r=d.toAddress(e,u,o,r),n=(t=r&(i=4294967295<<32-i))|~i,A.delay(function(){return A.map(f.id,B.range(t,n))})},d.isValidCidr=function(e){var t=e.BitmaskLength;return!(t<0||32<t)&&((e=d.toAddress(e.Address[0],e.Address[1],e.Address[2],e.Address[3]))&4294967295<<32-t)===e},d.toBytes=function(e){return[(4278190080&e)>>24&255,(16711680&e)>>16&255,(65280&e)>>8&255,255&e]},d.toAddress=function(e,t,n,r){return((B.toUInt(e)<<8|B.toUInt(t))<<8|B.toUInt(n))<<8|B.toUInt(r)},a.join=function(e,t){return _.ofSeq(t).join(e)},m.genPsk=function(e){return m.getRandomSeededBytes(32,e)},m.generateKeyPair=function(e){return f.axlsign.generateKeyPair(m.getRandomSeededBytes(32,e))},m.getRandomSeededBytes=function(e,t){var n;return n=new f.Uint8Array(e),A.iteri(function(e,t){n[e]=t},A.take(e,A.map(function(e){return 255&e},A.collect(function(e){return A.delay(function(){return A.append([(-16777216&e)>>24],A.delay(function(){return A.append([(16711680&e)>>16],A.delay(function(){return A.append([(65280&e)>>8],A.delay(function(){return[(255&e)>>0]}))}))}))})},A.initInfinite(function(){return t.int32()}))))),n},m.getRandomBytesFromBrowserCrypto=function(e){e=new f.Uint8Array(e);return m.crypto().getRandomValues(e),e},m.base64Decode=function(){return l.$cctor(),l.base64Decode},m.base64Encode=function(){return l.$cctor(),l.base64Encode},m.base64=function(){return l.$cctor(),l.base64},m.crypto=function(){return l.$cctor(),l.crypto},l.$cctor=function(){l.$cctor=f.ignore,l.crypto=f.crypto,l.base64=f.base64,l.base64Encode=function(e){return m.base64().bytesToBase64(e)},l.base64Decode=function(e){return m.base64().base64ToBytes(e)}},E.New=function(e,t,n,r,o,i,u){return{Address:e,PrivateKey:t,PublicKey:n,ListenPort:r,DNS:o,PostUp:i,PostDown:u}},g.New=function(e,t,n,r){return{PublicKey:e,PreSharedKey:t,AllowedIPs:n,Endpoint:r}},C.New=function(e,t,n,r){return{FriendlyName:e,ConfigFileName:t,Interface:n,Peers:r}},y.toConfigString=function(e){return a.join("\r\n",A.delay(function(){return A.append(["[Interface]"],A.delay(function(){return A.append([(t=f.id,function(e){return t("Address = "+L.toSafe(e))}(f.String(e.Interface.Address)))],A.delay(function(){return A.append([(t=f.id,function(e){return t("ListenPort = "+f.String(e))}(e.Interface.ListenPort))],A.delay(function(){return A.append([(t=f.id,function(e){return t("PrivateKey = "+L.toSafe(e))}(m.base64Encode()(e.Interface.PrivateKey)))],A.delay(function(){return A.append(A.map(function(e){return t=f.id,function(e){return t("PostUp = "+L.toSafe(e))}(e);var t},G.toList(e.Interface.PostUp)),A.delay(function(){return A.append(A.map(function(e){return t=f.id,function(e){return t("PostDown = "+L.toSafe(e))}(e);var t},G.toList(e.Interface.PostDown)),A.delay(function(){return A.append(A.map(function(e){return t=e[0],n=e[1],r=e[2],e=e[3],o=f.id,function(e){return o("DNS = "+L.toSafe(e))}(N.Curried(function(e,t,n,r,o){return e(f.String(t)+"."+f.String(n)+"."+f.String(r)+"."+f.String(o))},5)(f.id)(t)(n)(r)(e));var t,n,r,o},G.toList(e.Interface.DNS)),A.delay(function(){return A.append([""],A.delay(function(){return A.collect(function(e){return A.append(["[Peer]"],A.delay(function(){return A.append([(t=f.id,function(e){return t("PublicKey = "+L.toSafe(e))}(m.base64Encode()(e.PublicKey)))],A.delay(function(){return A.append(A.map(function(e){return t=f.id,function(e){return t("PresharedKey = "+L.toSafe(e))}(m.base64Encode()(e));var t},G.toList(e.PreSharedKey)),A.delay(function(){return A.append([(t=f.id,function(e){return t("AllowedIPs = "+L.toSafe(e))}(e.AllowedIPs))],A.delay(function(){return A.append(A.map(function(e){return t=f.id,function(e){return t("Endpoint = "+L.toSafe(e))}(e);var t},G.toList(e.Endpoint)),A.delay(function(){return[""]}))}));var t}))}));var t}))},e.Peers)}))}))}))}))}));var t}));var t}));var t}))}))},$.validateChoose=function(e,t,n){return U.Map(function(e){return e.$0},k.Is(function(e){return null!=e},t,U.Map(e,n)))},v.enabledDependentOn=function(e){return M.DynamicPred("disabled",x.Map(function(e){return!e},e),x.Const("disabled"))},v.noneIfEmpty=function(e){return""===e?null:{$:1,$0:e}},v.MaskLength=function(){return c.$cctor(),c["|MaskLength|_|"]},v.UByte=function(e){e=v.NumBetween(0,255,e);return null!=e&&1==e.$?{$:1,$0:255&e.$0}:null},v.NumBetween=function(e,t,n){var r;try{return e<=(r=F.ParseInt32(n))&&r<=t?{$:1,$0:r}:null}catch(e){return null}},v.integerBetween=function(t,n){var e,r;return r=function(e){return null==e?null:(e=e.$0,t<=e&&e<=n?{$:1,$0:e}:null)},e=function(e){return r(v.tryMapInt(e))},N.Curried3($.validateChoose)(e)},v.ParseInt32=function(){return c.$cctor(),c["|ParseInt32|_|"]},v.tryMapInt=function(e){try{return 0<e.length?{$:1,$0:F.ParseInt32(e)}:null}catch(e){return null}},v.Trim=function(e){return e.trim()},v.Split=function(e,t){return t.split(e)},c.$cctor=function(){c.$cctor=f.ignore,c["|ParseInt32|_|"]=v.tryMapInt,c["|MaskLength|_|"]=function(e){return v.NumBetween(0,32,e)}},h.Newsletter=function(){var n=V.Create$1(!1),e=U.Run(function(e){var t;t=e,K.Start(K.Delay(function(){return K.Bind((new O.New).Async("",[t]),function(){return n.Set(!0),K.Zero()})}),null)},U.WithSubmit(Q.op_LessMultiplyGreater(U.Return(f.id),k.IsNotEmpty("",U.Yield(""))))),e=U.Render(function(e){return function(e){return b.Element("a",[],[])}},e);return console.log(e),e},h.GenerateQrCode=function(e,t,n){var r,o;return e.length<2e3?(r=f.qrcodegen.QrCode,o=r.encodeText(e,r.Ecc.MEDIUM),b.Element("canvas",[M.Style("min-width",t),M.Style("max-height",n),M.Style("max-width",n),M.Class("pixelated"),M.OnAfterRender(function(e){o.drawCanvas(1,1,e)})],[])):b.get_Empty()},I.New=function(e,t,n,r,o,i,u,a,l,c){return{RandomSeed:e,Port:t,NumClients:n,CIDR:r,Endpoint:o,DNS:i,UsePSK:u,PostUp:a,PostDown:l,AllowedIPs:c}},n.Main$120$85=N.Curried3(function(e,t,n){return K.Start(e(),null)}),n.Main=function(){var c,e,w,S,t,n,r,o,i;function u(e){var t,n=y.toConfigString(e);return V.Create$1(null),W.Create("style",N.Curried3(function(e,t,n){return e("width:"+f.String(t)+"px; height:"+f.String(n)+"px")})(f.id)(300)(300)),b.Element("div",[],[b.Element("div",[M.Class("row")],[b.Element("div",[M.Class("col-md-12")],[b.Element("h3",[],[b.TextNode(e.FriendlyName)])])]),b.Element("div",[M.Class("row")],[b.Element("div",[M.Class("col-md-8")],[b.Element("table",[],[b.Element("tr",[],[b.Element("td",[],[b.TextNode("IP Address")]),b.Element("td",[],[b.Element("code",[],[b.TextNode(f.String(e.Interface.Address))])])]),b.Element("tr",[],[b.Element("td",[],[b.TextNode("Listen Port")]),b.Element("td",[],[b.Element("code",[],[b.TextNode((t=f.id,function(e){return t(f.String(e))}(e.Interface.ListenPort)))])])]),b.Element("tr",[],[b.Element("td",[],[b.TextNode("Private Key")]),b.Element("td",[],[b.Element("code",[],[b.TextNode(m.base64Encode()(e.Interface.PrivateKey))])])]),b.Element("tr",[],[b.Element("td",[],[b.TextNode("Public Key")]),b.Element("td",[],[b.Element("code",[],[b.TextNode(m.base64Encode()(e.Interface.PublicKey))])])])])])]),b.Element("div",[M.Class("row")],[b.Element("div",[M.Class("col-sm-12 col-md-8")],[b.Element("pre",[M.Class("wireguard-config bg-dark text-white")],[b.TextNode(n)])]),b.Element("div",[M.Class("col-sm-12 col-md-4")],[h.GenerateQrCode(n,"15em","20em")])])])}function s(e){var t,n,r,o=v.Split(".",e);return!j.Equals(o,null)&&4===o.length&&(null!=(n=v.UByte(_.get(o,0)))&&1==n.$&&(null!=(r=v.UByte(_.get(o,1)))&&1==r.$&&(null!=(e=v.UByte(_.get(o,2)))&&1==e.$&&(null!=(o=v.UByte(_.get(o,3)))&&1==o.$&&(t=[n.$0,r.$0,e.$0,o.$0])))))?{$:1,$0:[t[0],t[1],t[2],t[3]]}:null}return c=V.Create$1([]),e=x.Map(function(t){var e;function n(){var e=new f.JSZip,n=e.folder("configs");return A.iter(function(e){var t;n.file(e.ConfigFileName,(t=f.id,function(e){return t("# Generated by WireguardConfig.com\n"+L.toSafe(e))}(y.toConfigString(e))))},t),K.Delay(function(){return K.Bind(q.AsAsync(e.generateAsync({type:"blob"})),function(e){return f.saveAs(e,"wireguard_configs.zip"),K.Zero()})})}return e=A.map(u,t),0<_.length(t)?b.Element("div",[],P.ofSeq(A.delay(function(){return A.append([b.Element("hr",[],[])],A.delay(function(){return A.append([b.Element("h2",[],[b.TextNode("...and voila, here are your configs!")])],A.delay(function(){return A.append([b.Element("div",[],P.ofSeq(A.delay(function(){return[b.Element("button",P.ofArray([M.Class("download"),W.HandlerImpl("click",function(){return function(){return K.Start(n(),null)}})]),P.ofArray([b.Element("span",[],[b.TextNode("Download")]),b.Element("span",[],[b.TextNode("ZIP")])]))]})))],A.delay(function(){return e}))}))}))}))):b.get_Empty()},c.get_View()),t=m.getRandomBytesFromBrowserCrypto(256),i=m.base64Encode()(t),w=V.Create$1("3"),S=V.Create$1("10.0.0.0/24"),r=U.YieldVar(w),o=v.integerBetween(1,2e3)(N.Curried3(function(e,t,n){return e("Must be between "+f.String(t)+" and "+f.String(n))})(f.id)(1)(2e3))(r),n=$.validateChoose(function(e){var t,n=v.Split("/",v.Trim(e));return!j.Equals(n,null)&&2===n.length&&(null!=(e=s(_.get(n,0)))&&1==e.$&&(null!=(n=v.ParseInt32()(_.get(n,1)))&&1==n.$&&d.isValidCidr(p.New([e.$0[0],e.$0[1],e.$0[2],e.$0[3]],n.$0))&&(t=[e.$0[0],e.$0[1],n.$0,e.$0[2],e.$0[3]])))?{$:1,$0:p.New([t[0],t[1],t[3],t[4]],t[2])}:null},"Must be a valid CIDR",U.YieldVar(S)),U.Builder.Do,t=U.Dependent$1(o,function(t){return U.Dependent$1(k.Is(function(e){return A.length(A.filter(function(e){return e[0],e[1],e[2],0!==(e=e[3])&&255!==e},A.map(d.toBytes,d.generateIpsFromCidr(e))))>=t+1},"Not enough available IPs in given CIDR",n),function(e){return U.Return([t,e])})}),r=V.Create$1((0,f.id)("iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o "+L.toSafe("eth0")+" -j MASQUERADE")),o=V.Create$1((0,f.id)("iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o "+L.toSafe("eth0")+" -j MASQUERADE")),o=Q.op_LessMultiplyGreater(Q.op_LessMultiplyGreater(U.Return(function(t){return function(e){return[t,e]}}),U.Map(v.noneIfEmpty,U.YieldVar(r))),U.Map(v.noneIfEmpty,U.YieldVar(o))),o=U.Render(N.Curried(function(e,t,n,r,o,i,u,a,l,c){var s,d,f,p,m,y,E,g,C,$,v;return b.Element("div",[],[b.Element("div",[M.Class("row")],[(s=T.InputWithError("Random Seed"),$=P.ofArray([M.Class("col-12")]),v=s($),function(e){return v([e[0],e[1],e[2]])}([e,P.T.Empty,P.T.Empty])(c.view))]),b.Element("div",[M.Class("row")],[($=T.InputWithError("Listen Port"),e=P.ofArray([M.Class("col-sm-12 col-md-4")]),C=$(e),function(e){return C([e[0],e[1],e[2]])}([t,P.T.Empty,P.T.Empty])(c.view)),(e=T.InputWithError("Number of Clients"),t=P.ofArray([M.Class("col-sm-12 col-md-4")]),g=e(t),function(e){return g([e[0],e[1],e[2]])}([w,P.T.Empty,P.T.Empty])(c.view)),(e=T.InputWithError("CIDR"),t=P.ofArray([M.Class("col-sm-12 col-md-4")]),E=e(t),function(e){return E([e[0],e[1],e[2]])}([S,P.T.Empty,P.T.Empty])(c.view))]),b.Element("div",[M.Class("row")],[(e=T.InputWithError("Client Allowed IPs"),t=P.ofArray([M.Class("col-sm-12 col-md-4")]),y=e(t),function(e){return y([e[0],e[1],e[2]])}([l,P.T.Empty,P.T.Empty])(c.view)),(t=T.InputWithError("Endpoint (Optional)"),l=P.ofArray([M.Class("col-sm-12 col-md-4")]),m=t(l),function(e){return m([e[0],e[1],e[2]])}([r,P.T.Empty,P.T.Empty])(c.view)),(l=T.InputWithError("DNS (Optional)"),r=P.ofArray([M.Class("col-sm-12 col-md-4")]),p=l(r),function(e){return p([e[0],e[1],e[2]])}([o,P.T.Empty,P.T.Empty])(c.view))]),b.Element("div",[M.Class("row")],[(r=T.InputWithError("Post-Up rule"),o=P.ofArray([M.Class("col-12")]),f=r(o),function(e){return f([e[0],e[1],e[2]])}([u,P.T.Empty,P.T.Empty])(c.view)),(o=T.InputWithError("Post-Down rule"),u=P.ofArray([M.Class("col-12")]),d=o(u),function(e){return d([e[0],e[1],e[2]])}([a,P.T.Empty,P.T.Empty])(c.view)),T.Checkbox("Use Pre-Shared Keys (Enhanced Security)",P.ofArray([M.Class("col-12")]),i,[],[])]),b.Element("div",[M.Class("row")],[b.Element("div",[M.Class("col-4")],[T.Button()("Generate Config")(P.ofArray([M.Class("btn btn-primary")]))(function(){c.Trigger()})])])])},10),U.Run(function(i){var n,e,u,t,r,o,a,l;l=A.take(i.NumClients+1,A.filter(function(e){return e[0],e[1],e[2],0!==(e=e[3])&&255!==e},A.map(d.toBytes,d.generateIpsFromCidr(i.CIDR)))),n=new Y.seedrandom(i.RandomSeed),e=A.cache(A.map(function(e){return[e,m.generateKeyPair(n)]},l)),l=A.head(e),u=l[1],t=A.cache(A.map(function(e){return t=e[0],e=e[1],[t,e,i.UsePSK?{$:1,$0:m.genPsk(n)}:null];var t},A.skip(1,e))),r=C.New("Server","server.conf",E.New(p.New(l[0],i.CIDR.BitmaskLength),u.private,u.public,i.Port,null,i.PostUp,i.PostDown),_.ofSeq(A.delay(function(){return A.collect(function(e){return[g.New(e[1].public,e[2],N.Curried(function(e,t,n,r,o){return e(f.String(t)+"."+f.String(n)+"."+f.String(r)+"."+f.String(o)+"/32")},5)(f.id)(e[0][0])(e[0][1])(e[0][2])(e[0][3]),null)]},t)}))),l=i.DNS,a=null==l?null:s(l.$0),o=A.mapi(function(e,t){var n,r,o=t[1];return C.New((r=f.id,function(e){return r("Client "+f.String(e))}(e+1)),(n=f.id,function(e){return n("client_"+L.padNumLeft(f.String(e),5)+".conf")}(e+1)),E.New(p.New(t[0],i.CIDR.BitmaskLength),o.private,o.public,i.Port,a,null,null),[g.New(u.public,t[2],i.AllowedIPs,i.Endpoint)])},t),c.Set(_.ofSeq(A.delay(function(){return A.append([r],A.delay(function(){return o}))})))},U.WithSubmit(Q.op_LessMultiplyGreater(Q.op_LessMultiplyGreater(Q.op_LessMultiplyGreater(Q.op_LessMultiplyGreater(Q.op_LessMultiplyGreater(Q.op_LessMultiplyGreater(Q.op_LessMultiplyGreater(Q.op_LessMultiplyGreater(U.Return(N.Curried3(function(u,a,e){var l=e[0],c=e[1];return N.Curried(function(t,n,r,e){var o=e[0],i=e[1];return function(e){return I.New(u,a,l,c,t,n,r,o,i,e)}},4)})),k.IsNotEmpty("The random seed should be non-empty.",U.Yield(i))),(i=U.Yield("51820"),v.integerBetween(0,65535)(N.Curried3(function(e,t,n){return e("Must be between "+f.String(t)+" and "+f.String(n))})(f.id)(0)(65535))(i))),t),U.Map(v.noneIfEmpty,U.Yield("myserver.dyndns.org:51820"))),U.Map(v.noneIfEmpty,U.Yield(""))),U.Yield(!1)),o),k.IsNotEmpty("Allowed IPs cannot be empty",U.Yield("0.0.0.0/0, ::/0")))))),b.Element("div",[],[b.Element("h2",[],[b.TextNode("Wireguard Config Generator")]),b.Element("div",[],[b.Element("p",[],[b.TextNode("This tool is to assist with creating config files for a WireGuard 'road-warrior' setup whereby you have a server and a bunch of clients. Simply enter the parameters for your particular setup and click Generate Config to get started.")]),b.Element("p",[M.Class("alert alert-info")],[b.TextNode("All keys, QR codes and config files are generated client-side by your browser and are never seen by our server.")])]),o,b.Element("br",[],[]),h.Newsletter(),b.EmbedView(e)])},s.Main=function(){return b.Element("div",[],[b.Element("h2",[],[b.TextNode("QR Code Generator")]),b.Element("div",[],[b.Element("p",[],[b.TextNode("This tool allows you to easily convert a wireguard config file into a QR code")]),b.Element("p",[M.Class("alert alert-info")],[b.TextNode("QR codes are generated client-side by your browser and are never seen by our server.")])]),s.f(),b.Element("div",[M.Class("row")],[b.Element("div",[M.Class("col-sm-12 col-md-4")],[b.EmbedView(s.qrMarkup())])]),b.Element("br",[],[]),h.Newsletter()])},s.f=function(){return w.$cctor(),w.f},s.qrMarkup=function(){return w.$cctor(),w.qrMarkup},s.configForm=function(){return w.$cctor(),w.configForm},s.config=function(){return w.$cctor(),w.config},s.sampleConfig=function(){return w.$cctor(),w.sampleConfig},w.$cctor=function(){w.$cctor=f.ignore,w.sampleConfig="# THIS IS A SAMPLE - PASTE YOUR REAL CONFIG HERE!\n[Interface]\nAddress = 10.0.0.1/24\nListenPort = 51820\nPrivateKey = AKfKfwytjTVuWUfnFHcMJ3OZW2MgLavsnPaR/X/AEW4=\nPostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\nPostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE\n\n[Peer]\nPublicKey = XDxcjkIzlGjbtbPwlpR/ZcLB2uv7e+DojytSeAA6f14=\nAllowedIPs = 10.0.0.2/32\n\n[Peer]\nPublicKey = aCTaVGra0OCe8ZAUeqTrfTXdR3NaR91P5JJi/0Hxam8=\nAllowedIPs = 10.0.0.3/32",w.config=V.Create$1(null),w.configForm=U.Run(function(e){s.config().Set({$:1,$0:e})},U.WithSubmit(Q.op_LessMultiplyGreater(U.Return(f.id),k.Is(function(e){return e.length<=2e3},"Max length is 2000 characters",k.IsNotEmpty("The config file contents need to be pasted here.",U.Yield(s.sampleConfig())))))),w.qrMarkup=x.Map(function(e){return null!=e&&1==e.$?h.GenerateQrCode(e.$0,"30em","30em"):b.get_Empty()},s.config().get_View()),w.f=U.Render(function(i){return function(e){return t=i,n=e,b.Element("div",[],[b.Element("div",[M.Class("row")],[(r=T.TextAreaWithError("Paste the contents of your config file below and click generate"),e=P.ofArray([M.Class("col-12")]),o=r(e),function(e){return o([e[0],e[1],e[2]])}([t,P.T.Empty,P.ofArray([M.Class("multiline")])])(n.view))]),b.Element("div",[M.Class("row")],[b.Element("div",[M.Class("col-4")],[T.Button()("Generate QR Code")(P.ofArray([M.Class("btn btn-primary")]))(function(){n.Trigger()})])])]);var t,n,r,o}},s.configForm())}}();