!function(){"use strict";var N=self,e=N.WebSharper=N.WebSharper||{},t=e.UI=e.UI||{},f=t.Array=t.Array||{},a=t.String=t.String||{},l=t.List=t.List||{},n=t.Abbrev=t.Abbrev||{},d=n.Fresh=n.Fresh||{},r=n.HashSet=n.HashSet||{},u=n.Dict=n.Dict||{},o=e&&e.Obj,i=n.Slot=n.Slot||{},c=n.Async=n.Async||{},s=n.Mailbox=n.Mailbox||{},$=N.StartupCode$WebSharper_UI$Abbrev=N.StartupCode$WebSharper_UI$Abbrev||{},p=t.AppendList=t.AppendList||{},h=N.StartupCode$WebSharper_UI$AppendList=N.StartupCode$WebSharper_UI$AppendList||{},A=t.DomUtility=t.DomUtility||{},m=N.StartupCode$WebSharper_UI$DomUtility=N.StartupCode$WebSharper_UI$DomUtility||{},y=t.Trie=t.Trie||{},v=y.LookupResult=y.LookupResult||{},C=N.StartupCode$WebSharper_UI$Trie=N.StartupCode$WebSharper_UI$Trie||{},g=t.Snap=t.Snap||{},w=t.Var=t.Var||{},S=t.View=t.View||{},E=t.ConcreteVar=t.ConcreteVar||{},I=t.Var$1=t.Var$1||{},M=t.Updates=t.Updates||{},b=t.FromView=t.FromView||{},T=t.ViewBuilder=t.ViewBuilder||{},F=t.Submitter=t.Submitter||{},k=t.Key=t.Key||{},V=t.Model=t.Model||{},L=t.Serializer=t.Serializer||{},R=t.Storage=t.Storage||{},_=R.ArrayStorage=R.ArrayStorage||{},x=R.LocalStorageBackend=R.LocalStorageBackend||{},D=t.ListModel=t.ListModel||{},U=t.ListModels=t.ListModels||{},B=N.StartupCode$WebSharper_UI$Models=N.StartupCode$WebSharper_UI$Models||{},P=t.ReactiveExtensions=t.ReactiveExtensions||{},G=t.DoubleInterpolation=t.DoubleInterpolation||{},q=t.Interpolation=t.Interpolation||{},O=t.Easing=t.Easing||{},W=t.Easings=t.Easings||{},H=t.An=t.An||{},K=t.Anims=t.Anims||{},z=t.Trans=t.Trans||{},j=N.StartupCode$WebSharper_UI$Animation=N.StartupCode$WebSharper_UI$Animation||{},J=e&&e.Web,X=J&&J.Control,Z=t.OnAfterRenderControl=t.OnAfterRenderControl||{},Q=t.AnimatedAttrNode=t.AnimatedAttrNode||{},Y=t.DynamicAttrNode=t.DynamicAttrNode||{},ee=t.AttrProxy=t.AttrProxy||{},te=t.Client=t.Client||{},ne=te.Attrs=te.Attrs||{},re=ne.Dyn=ne.Dyn||{},ue=t.Attrs=t.Attrs||{},ie=t.CheckedInput=t.CheckedInput||{},oe=t.BindVar=t.BindVar||{},ae=t.AttrModule=t.AttrModule||{},le=N.StartupCode$WebSharper_UI$Attr_Client=N.StartupCode$WebSharper_UI$Attr_Client||{},ce=te.Settings=te.Settings||{},se=t.DocElemNode=t.DocElemNode||{},fe=te.Docs=te.Docs||{},de=fe.DomNodes=fe.DomNodes||{},$e=fe.NodeSet=fe.NodeSet||{},pe=fe.RunState=fe.RunState||{},he=t.Docs=t.Docs||{},me=t.Doc=t.Doc||{},ye=t.Elt=t.Elt||{},ve=te.EltUpdater=te.EltUpdater||{},Ce=N.StartupCode$WebSharper_UI$Doc_Proxy=N.StartupCode$WebSharper_UI$Doc_Proxy||{},ge=te.Templates=te.Templates||{},we=ge.Prepare=ge.Prepare||{},Se=N.StartupCode$WebSharper_UI$Templates=N.StartupCode$WebSharper_UI$Templates||{},Ne=t.Flow=t.Flow||{},Ae=t.FlowBuilder=t.FlowBuilder||{},Ee=t.HtmlModule=t.HtmlModule||{},Ie=Ee.attr=Ee.attr||{},Me=t.Router=t.Router||{},be=t.Route=t.Route||{},Te=t.Routing=t.Routing||{},Fe=t.RouteMap=t.RouteMap||{},ke=t.Input=t.Input||{},Ve=ke.MousePosSt=ke.MousePosSt||{},Le=ke.MouseBtnSt=ke.MouseBtnSt||{},Re=ke.Mouse=ke.Mouse||{},_e=ke.KeyListenerSt=ke.KeyListenerSt||{},J=ke.Keyboard=ke.Keyboard||{},xe=N.StartupCode$WebSharper_UI$Input=N.StartupCode$WebSharper_UI$Input||{},De=e&&e.List,Ue=e&&e.Arrays,Be=e&&e.Enumerator,Pe=e&&e.Strings,Ge=e&&e.Char,ne=e&&e.Collections,qe=ne&&ne.HashSet,Oe=e&&e.Seq,fe=N.IntelliFactory,We=fe&&fe.Runtime,He=e&&e.Unchecked,Ke=N.console,ze=e&&e.Concurrency,je=ne&&ne.Map,Je=ne&&ne.FSharpMap,Xe=e&&e.Operators,Ze=e&&e.Queue,Qe=e&&e.Lazy,Ye=ne&&ne.Dictionary,et=N.JSON,tt=e&&e.Numeric,nt=N.Node,rt=e&&e.Slice,ne=e&&e.Sitelets,ut=ne&&ne.RouterModule,it=ne&&ne.Route,ot=e&&e.Utils,at=e&&e.Option;f.mapInPlace=function(e,t){for(var n=0,r=t.length-1;n<=r;n++)t[n]=e(t[n]);return t},f.ofSeqNonCopying=function(e){var t,n;if(e instanceof N.Array)return e;if(e instanceof De.T)return Ue.ofList(e);if(null===e)return[];t=[],n=Be.Get(e);try{for(;n.MoveNext();)t.push(n.Current());return t}finally{"object"==typeof n&&"Dispose"in n&&n.Dispose()}},f.MapTreeReduce=function(u,i,o,a){var l;return function e(t,n){var r;return n<=0?i:1===n&&0<=t&&t<l?u(Ue.get(a,t)):o(e(t,r=n/2>>0),e(t+r,n-r))}(0,l=Ue.length(a))},f.TreeReduce=function(u,i,o){var a;return function e(t,n){var r;return n<=0?u:1===n&&0<=t&&t<a?Ue.get(o,t):i(e(t,r=n/2>>0),e(t+r,n-r))}(0,a=Ue.length(o))},a.isBlank=function(e){return Pe.forall(Ge.IsWhiteSpace,e)},l.maybeReplaceFirst=function(n,r,e){var u=[!1];return De.map(function(e){var t;return!u[0]&&n(e)?null==(t=r(e))?e:t.$0:e},e)},l.replaceFirst=function(t,n,e){var r=[!1];return De.map(function(e){return!r[0]&&t(e)?n(e):e},e)},d.Id=function(){return d.set_counter(d.counter()+1),"uid"+N.String(d.counter())},d.Int=function(){return d.set_counter(d.counter()+1),d.counter()},d.counter=function(){return $.$cctor(),$.counter},d.set_counter=function(e){$.$cctor(),$.counter=e},r.Filter=function(e,t){return new qe.New$2(Ue.filter(e,r.ToArray(t)))},r.Intersect=function(e,t){e=new qe.New$2(r.ToArray(e));return e.IntersectWith(r.ToArray(t)),e},r.Except=function(e,t){t=new qe.New$2(r.ToArray(t));return t.ExceptWith(r.ToArray(e)),t},r.ToArray=function(e){var t=Ue.create(e.get_Count(),void 0);return e.CopyTo(t),t},u.ToValueArray=function(e){var n=Ue.create(e.count,void 0);return Oe.iteri(function(e,t){return Ue.set(n,e,t.V)},e),n},u.ToKeyArray=function(e){var n=Ue.create(e.count,void 0);return Oe.iteri(function(e,t){return Ue.set(n,e,t.K)},e),n},(i=n.Slot=We.Class({GetHashCode:function(){return He.Hash(this.key(this.value))},Equals:function(e){return He.Equals(this.key(this.value),this.key(e.get_Value()))},get_Value:function(){return this.value}},o,i)).New=We.Ctor(function(e,t){o.New.call(this),this.key=e,this.value=t},i),i.Create=function(e,t){return new i.New(e,t)},c.OnError=function(e){return Ke.log("WebSharper UI: Uncaught asynchronous exception",e)},c.StartTo=function(e,t){ze.StartWithContinuations(e,t,function(e){c.OnError(e)},N.ignore,null)},s.StartProcessor=function(n){var r;return r=[0],function(){var e=r[0];0===e?(r[0]=1,ze.Start(function t(){return ze.Delay(function(){return ze.Bind(n,function(){var e=r[0];return 1===e?(r[0]=0,ze.Zero()):2===e?(r[0]=1,t()):ze.Zero()})})}(),null)):1===e&&(r[0]=2)}},$.$cctor=function(){$.$cctor=N.ignore,$.counter=0},p.FromArray=function(e){var t=e.length;return 0===t?{$:0}:1===t?{$:1,$0:Ue.get(e,0)}:{$:3,$0:e.slice()}},p.ToArray=function(e){var n;return n=[],function e(t){1==t.$?n.push(t.$0):2==t.$?(e(t.$0),e(t.$1)):3==t.$&&Ue.iter(function(e){n.push(e)},t.$0)}(e),n.slice(0)},p.Single=function(e){return{$:1,$0:e}},p.Concat=function(e){e=f.ofSeqNonCopying(e);return f.TreeReduce(p.Empty(),p.Append,e)},p.Append=function(e,t){return 0==e.$?t:0==t.$?e:{$:2,$0:e,$1:t}},p.Empty=function(){return h.$cctor(),h.Empty},h.$cctor=function(){h.$cctor=N.ignore,h.Empty={$:0}},A.ParseHTMLIntoFakeRoot=function(e){var t,n=self.document.createElement("div");return A.rhtml().test(e)?(t=A.rtagName().exec(e),t=He.Equals(t,null)?"":Ue.get(t,1).toLowerCase(),t=A.wrapMap()[t]||A.defaultWrap(),n.innerHTML=t[1]+e.replace(A.rxhtmlTag(),"<$1></$2>")+t[2],function(e,t){for(;;){if(0===t)return e;e=e.lastChild,t=t-1}}(n,t[0])):(n.appendChild(self.document.createTextNode(e)),n)},A.defaultWrap=function(){return m.$cctor(),m.defaultWrap},A.wrapMap=function(){return m.$cctor(),m.wrapMap},A.rhtml=function(){return m.$cctor(),m.rhtml},A.rtagName=function(){return m.$cctor(),m.rtagName},A.rxhtmlTag=function(){return m.$cctor(),m.rxhtmlTag},A.IterSelector=function(e,t,n){for(var r=e.querySelectorAll(t),u=0,i=r.length-1;u<=i;u++)n(r[u])},A.ChildrenArray=function(e){for(var t=[],n=0,r=e.childNodes.length-1;n<=r;n++)t.push(e.childNodes[n]);return t},A.RemoveClass=function(e,t){A.setClass(e,(t=A.clsRE(t),A.getClass(e).replace(t,function(e,t,n){return""===t||""===n?"":" "})))},A.AddClass=function(e,t){var n=A.getClass(e);""===n?A.setClass(e,t):A.clsRE(t).test(n)||A.setClass(e,n+" "+t)},A.setClass=function(e,t){e instanceof N.SVGElement?e.setAttribute("class",t):e.className=t},A.getClass=function(e){return e instanceof N.SVGElement?e.getAttribute("class"):e.className},A.clsRE=function(e){return new N.RegExp("(\\s+|^)"+e+"(?:\\s+"+e+")*(\\s+|$)","g")},A.InsertAt=function(e,t,n){var r;n.parentNode===e&&t===(r=n.nextSibling,He.Equals(r,null)?null:r)||e.insertBefore(n,t)},A.RemoveNode=function(e,t){t.parentNode===e&&e.removeChild(t)},m.$cctor=function(){var e;m.$cctor=N.ignore,m.rxhtmlTag=new N.RegExp("<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>","gi"),m.rtagName=new N.RegExp("<([\\w:]+)"),m.rhtml=new N.RegExp("<|&#?\\w+;"),m.wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:e=[1,"<table>","</table>"],tbody:e,tfoot:e,tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><colgroup>","</colgoup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"]},m.defaultWrap=[0,"",""]},v.NotFound={$:1},y.Empty=function(){return C.$cctor(),C.Empty},y.Lookup=function(e,t){return y.Look(De.ofSeq(t),e)},y.Look=function(e,t){var n,r;switch(2==t.$?(n=t.$0,0):0==t.$&&1==e.$?(n=[e.$0,e.$1,t.$0],1):2){case 0:return{$:0,$0:n,$1:e};case 1:return null==(r=je.TryFind(n[0],n[2]))?v.NotFound:y.Look(n[1],r.$0);case 2:return v.NotFound}},y.ToArray=function(e){var t=[];return y.Map(function(){return function(e){return t.push(e)}},e),t.slice(0)},y.Mapi=function(n,e){var r;return r=[0],y.Map(function(e){return n((t=r[0],r[0]=t+1,t),e);var t},e)},y.Map=function(e,t){return y.MapLoop(De.T.Empty,e,t)},y.MapLoop=function(n,r,e){return 1==e.$?{$:1}:2==e.$?{$:2,$0:r(n)(e.$0)}:y.TrieBranch(je.Map(function(e,t){return y.MapLoop(De.append(n,De.ofArray([e])),r,t)},e.$0))},y.Merge=function(e){var t=f.ofSeqNonCopying(e),e=Ue.length(t);return 0===e?{$:1,$0:{$:1}}:1===e?{$:1,$0:Ue.get(t,0)}:Ue.exists(y.IsLeaf,t)?null:null==(t=y.MergeMaps(y.Merge,Oe.choose(function(e){return 0==e.$?{$:1,$0:e.$0}:null},t)))?null:{$:1,$0:y.TrieBranch(t.$0)}},y.IsLeaf=function(e){return 2==e.$},y.MergeMaps=function(n,e){return null==(e=y.AllSome(Oe.map(function(e){return t=e[0],e=e[1],null==(e=n(e))?null:{$:1,$0:[t,e.$0]};var t},je.ToSeq((e=Oe.collect(je.ToSeq,e),Oe.fold(function(e,t){return y.MultiAdd(t[0],t[1],e)},new Je.New([]),e))))))?null:{$:1,$0:je.OfArray(Ue.ofSeq(e.$0))}},y.AllSome=function(e){for(var t,n=Be.Get(e),r=[],u=!0;u&&n.MoveNext();)null!=(t=n.Current())&&1==t.$?r.push(t.$0):u=!1;return u?{$:1,$0:r.slice()}:null},y.MultiAdd=function(e,t,n){return n.Add(e,new De.T({$:1,$0:t,$1:y.MultiFind(e,n)}))},y.MultiFind=function(e,t){t=je.TryFind(e,t);return null==t?De.T.Empty:t.$0},y.Prefix=function(e,t){return y.TrieBranch(new Je.New(De.ofArray([[e,t]])))},y.Leaf=function(e){return{$:2,$0:e}},y.TrieBranch=function(e){return e.get_IsEmpty()?{$:1}:{$:0,$0:e}},C.$cctor=function(){C.$cctor=N.ignore,C.Empty={$:1}},g.Obsolete=function(e){var t,n,r,u,i=e.s;if(null!=i&&(null!=i&&2==i.$||null!=i&&3==i.$)&&(t=i.$1,!0))for(e.s=null,n=0,r=Ue.length(t)-1;n<=r;n++)"object"==typeof(u=Ue.get(t,n))?g.Obsolete(u):u();else;},g.New=function(e){return{s:e}},g.MapAsync=function(t,n){var r=g.New({$:3,$0:[],$1:[]});return g.When(n,function(e){c.StartTo(t(e),function(e){g.MarkDone(r,n,e)})},r),r},g.SnapshotOn=function(r,u){var i;function e(e){var t,n;null!=(n=i.s)&&0==n.$||null!=n&&2==n.$||(t=g.ValueAndForever(r),n=g.ValueAndForever(u),null==t||1!=t.$||null!=n&&1==n.$&&(t.$0[1]||n.$0[1]?g.MarkForever(i,n.$0[0]):g.MarkReady(i,n.$0[0])))}return i=g.New({$:3,$0:[],$1:[]}),g.When(r,e,i),g.WhenReady(u,e),i},g.Map3=function(u,i,o,a){var e,t,n,l;function r(e){var t,n,r;null!=(r=l.s)&&0==r.$||null!=r&&2==r.$||(t=g.ValueAndForever(i),n=g.ValueAndForever(o),r=g.ValueAndForever(a),null!=t&&1==t.$&&(null==n||1!=n.$||null!=r&&1==r.$&&(t.$0[1]&&n.$0[1]&&r.$0[1]?g.MarkForever(l,u(t.$0[0],n.$0[0],r.$0[0])):g.MarkReady(l,u(t.$0[0],n.$0[0],r.$0[0])))))}return e=i.s,t=o.s,n=a.s,null!=e&&0==e.$?null!=t&&0==t.$?null!=n&&0==n.$?g.New({$:0,$0:u(e.$0,t.$0,n.$0)}):g.Map3Opt1(u,e.$0,t.$0,a):null!=n&&0==n.$?g.Map3Opt2(u,e.$0,n.$0,o):g.Map3Opt3(u,e.$0,o,a):null!=t&&0==t.$?null!=n&&0==n.$?g.Map3Opt4(u,t.$0,n.$0,i):g.Map3Opt5(u,t.$0,i,a):null!=n&&0==n.$?g.Map3Opt6(u,n.$0,i,o):(l=g.New({$:3,$0:[],$1:[]}),g.When(i,r,l),g.When(o,r,l),g.When(a,r,l),l)},g.Map3Opt6=function(n,r,e,t){return g.Map2(function(e,t){return n(e,t,r)},e,t)},g.Map3Opt5=function(n,r,e,t){return g.Map2(function(e,t){return n(e,r,t)},e,t)},g.Map3Opt4=function(t,n,r,e){return g.Map(function(e){return t(e,n,r)},e)},g.Map3Opt3=function(n,r,e,t){return g.Map2(function(e,t){return n(r,e,t)},e,t)},g.Map3Opt2=function(t,n,r,e){return g.Map(function(e){return t(n,e,r)},e)},g.Map3Opt1=function(t,n,r,e){return g.Map(function(e){return t(n,r,e)},e)},g.Map2Unit=function(n,r){var e,t,u;function i(){var e,t;null!=(t=u.s)&&0==t.$||null!=t&&2==t.$||(e=g.ValueAndForever(n),t=g.ValueAndForever(r),null==e||1!=e.$||null!=t&&1==t.$&&(e.$0[1]&&t.$0[1]?g.MarkForever(u,null):g.MarkReady(u,null)))}return e=n.s,t=r.s,null!=e&&0==e.$?null!=t&&0==t.$?g.New({$:0,$0:null}):r:null!=t&&0==t.$?n:(u=g.New({$:3,$0:[],$1:[]}),g.When(n,i,u),g.When(r,i,u),u)},g.Map2=function(r,u,i){var e,t,o;function n(e){var t,n;null!=(n=o.s)&&0==n.$||null!=n&&2==n.$||(t=g.ValueAndForever(u),n=g.ValueAndForever(i),null==t||1!=t.$||null!=n&&1==n.$&&(t.$0[1]&&n.$0[1]?g.MarkForever(o,r(t.$0[0],n.$0[0])):g.MarkReady(o,r(t.$0[0],n.$0[0]))))}return e=u.s,t=i.s,null!=e&&0==e.$?null!=t&&0==t.$?g.New({$:0,$0:r(e.$0,t.$0)}):g.Map2Opt1(r,e.$0,i):null!=t&&0==t.$?g.Map2Opt2(r,t.$0,u):(o=g.New({$:3,$0:[],$1:[]}),g.When(u,n,o),g.When(i,n,o),o)},g.Map2Opt2=function(t,n,e){return g.Map(function(e){return t(e,n)},e)},g.Map2Opt1=function(t,n,e){return g.Map(function(e){return t(n,e)},e)},g.MapCachedBy=function(r,u,i,e){return g.Map(function(e){var t,n=u[0];return null!=n&&1==n.$&&r(e,n.$0[0])&&(t=[n.$0[0],n.$0[1]])?t[1]:(t=i(e),u[0]={$:1,$0:[e,t]},t)},e)},g.Copy=function(t){var e,n,r=t.s;return null==r?t:null!=r&&2==r.$?(e=g.New({$:2,$0:r.$0,$1:[]}),g.WhenObsolete(t,e),e):null!=r&&3==r.$?(n=g.New({$:3,$0:[],$1:[]}),g.When(t,function(e){g.MarkDone(n,t,e)},n),n):t},g.WithInitOption=function(e){var t,n,r=e.s;return null==r?g.New(null):null!=r&&2==r.$?(t=g.New({$:2,$0:{$:1,$0:r.$0},$1:[]}),g.WhenObsolete(e,t),t):null!=r&&3==r.$?(n=g.New({$:2,$0:null,$1:[]}),g.When(e,function(){g.Obsolete(n)},n),n):g.New({$:0,$0:{$:1,$0:r.$0}})},g.WithInit=function(e,t){var n,r,u=t.s;return null==u?t:null!=u&&2==u.$?(n=g.New({$:2,$0:u.$0,$1:[]}),g.WhenObsolete(t,n),n):null!=u&&3==u.$?(r=g.New({$:2,$0:e,$1:[]}),g.When(t,function(){g.Obsolete(r)},r),r):t},g.Map=function(t,n){var r,e=n.s;return null!=e&&0==e.$?g.New({$:0,$0:t(e.$0)}):(r=g.New({$:3,$0:[],$1:[]}),g.When(n,function(e){g.MarkDone(r,n,t(e))},r),r)},g.Sequence=function(e){var n,r,u;function t(e){var t;0===u[0]?(t=Ue.map(function(e){e=e.s;return null!=e&&0==e.$||null!=e&&2==e.$?e.$0:Xe.FailWith("value not found by View.Sequence")},n),Ue.forall(function(e){e=e.s;return null!=e&&0==e.$},n)?g.MarkForever(r,t):g.MarkReady(r,t)):u[0]--}return 0==(n=Ue.ofSeq(e)).length?g.New({$:0,$0:[]}):(r=g.New({$:3,$0:[],$1:[]}),u=[Ue.length(n)-1],Ue.iter(function(e){g.When(e,t,r)},n),r)},g.CreateForeverAsync=function(e){var t=g.New({$:3,$0:[],$1:[]});return c.StartTo(e,function(e){g.MarkForever(t,e)}),t},g.JoinInner=function(r){var u=g.New({$:3,$0:[],$1:[]});return g.When(r,function(e){var n=e();g.When(n,function(e){var t;null!=(t=n.s)&&0==t.$&&(null!=(t=r.s)&&0==t.$)?g.MarkForever(u,e):g.MarkReady(u,e)},u),g.WhenObsolete(r,n)},u),u},g.Join=function(r){var u=g.New({$:3,$0:[],$1:[]});return g.When(r,function(e){var n=e();g.When(n,function(e){var t;null!=(t=n.s)&&0==t.$&&(null!=(t=r.s)&&0==t.$)?g.MarkForever(u,e):g.MarkReady(u,e)},u)},u),u},g.ValueAndForever=function(e){e=e.s;return null!=e&&0==e.$?{$:1,$0:[e.$0,!0]}:null!=e&&2==e.$?{$:1,$0:[e.$0,!1]}:null},g.WhenObsoleteRun=function(e,t){e=e.s;null==e?t():(null!=e&&2==e.$||null!=e&&3==e.$)&&e.$1.push(t)},g.WhenObsolete=function(e,t){e=e.s;null==e?g.Obsolete(t):(null!=e&&2==e.$||null!=e&&3==e.$)&&g.EnqueueSafe(e.$1,t)},g.WhenReady=function(e,t){var n,r=e.s;switch(null!=r&&2==r.$?(n=r.$0,0):null==r?1:null!=r&&3==r.$?2:(n=r.$0,0)){case 0:t(n);break;case 1:break;case 2:r.$0.push(t)}},g.WhenRun=function(e,t,n){e=e.s;null==e?n():null!=e&&2==e.$?(e.$1.push(n),t(e.$0)):null!=e&&3==e.$?(e.$0.push(t),e.$1.push(n)):t(e.$0)},g.When=function(e,t,n){e=e.s;null==e?g.Obsolete(n):null!=e&&2==e.$?(g.EnqueueSafe(e.$1,n),t(e.$0)):null!=e&&3==e.$?(e.$0.push(t),g.EnqueueSafe(e.$1,n)):t(e.$0)},g.EnqueueSafe=function(e,t){var n,r,u,i;if(e.push(t),e.length%20==0)for(n=e.slice(0),Ze.Clear(e),r=0,u=Ue.length(n)-1;r<=u;r++)"object"==typeof(i=Ue.get(n,r))&&!i.s||e.push(i)},g.MarkDone=function(e,t,n){null!=(t=t.s)&&0==t.$?g.MarkForever(e,n):g.MarkReady(e,n)},g.MarkReady=function(e,t){var n,r,u,i=e.s;if(null!=i&&3==i.$)for(e.s={$:2,$0:t,$1:i.$1},n=i.$0,r=0,u=Ue.length(n)-1;r<=u;r++)Ue.get(n,r)(t)},g.MarkForever=function(e,t){var n,r,u,i=e.s;if(null!=i&&3==i.$)for(e.s={$:0,$0:t},n=i.$0,r=0,u=Ue.length(n)-1;r<=u;r++)Ue.get(n,r)(t)},g.TryGet=function(e){var t,e=e.s;return(null!=e&&0==e.$||null!=e&&2==e.$)&&(t=e.$0,1)?{$:1,$0:t}:null},(w=t.Var=We.Class({},o,w)).New=We.Ctor(function(){o.New.call(this)},w),S=t.View=We.Class({get_V:function(){return Xe.FailWith("View<'T>.V can only be called in an argument to a V-enabled function or if 'T = Doc.")}},null,S),(E=t.ConcreteVar=We.Class({get_Id:function(){return"uinref"+N.String(this.id)},get_View:function(){return this.view},UpdateMaybe:function(e){e=e(this.Get());null!=e&&1==e.$&&this.Set(e.$0)},Update:function(e){this.Set(e(this.Get()))},SetFinal:function(e){this.isConst?Ke.log("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal"):(g.Obsolete(this.snap),this.isConst=!0,this.current=e,this.snap=g.New({$:0,$0:e}))},Set:function(e){this.isConst?Ke.log("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal"):(g.Obsolete(this.snap),this.current=e,this.snap=g.New({$:2,$0:e,$1:[]}))},Get:function(){return this.current}},w,E)).New=We.Ctor(function(e,t,n){var r=this;w.New.call(this),this.isConst=e,this.current=n,this.snap=t,this.view=function(){return r.snap},this.id=d.Int()},E),(I=t.Var$1=We.Class({},o,I)).MapLens=function(i,o,a){return S.MapSeqCachedViewBy(i,function(t,e){var n,r;function u(e){return He.Equals(i(e),t)}return n=d.Id(),o((r=new w({Get:function(){return Oe.find(u,a.Get())},Set:function(t){function n(e){return t}return a.Update(function(e){return l.replaceFirst(u,n,e)})},SetFinal:function(e){return this.Set(e)},Update:function(t){return a.Update(function(e){return l.replaceFirst(u,t,e)})},UpdateMaybe:function(t){return a.Update(function(e){return l.maybeReplaceFirst(u,t,e)})},get_View:function(){return e},get_Id:function(){return n}}),w.New.call(r),r))},a.get_View())},I.Lens=function(e,r,u){var t=d.Id(),n=S.Map(r,e.get_View()),i=new w({Get:function(){return r(e.Get())},Set:function(t){return e.Update(function(e){return u(e,t)})},SetFinal:function(e){return this.Set(e)},Update:function(t){return e.Update(function(e){return u(e,t(r(e)))})},UpdateMaybe:function(n){return e.UpdateMaybe(function(e){var t=n(r(e));return null==t?null:{$:1,$0:u(e,t.$0)}})},get_View:function(){return n},get_Id:function(){return t}});return w.New.call(i),i},I.Update=function(e,t){I.Set(e,t(e.Get()))},I.SetFinal=function(e,t){e.SetFinal(t)},I.Set=function(e,t){e.Set(t)},I.CreateWaiting=function(){return new E.New(!1,g.New({$:3,$0:[],$1:[]}),null)},I.Create=function(){return new E.New(!1,g.New({$:2,$0:null,$1:[]}),null)},I.CreateLogged=function(e,t){return self.UINVars||(self.UINVars=[]),t=I.Create$1(t),self.UINVars.push([e,t]),t},I.Create$1=function(e){return new E.New(!1,g.New({$:2,$0:e,$1:[]}),e)},I.New=We.Ctor(function(){o.New.call(this)},I),(M=t.Updates=We.Class({set_Value:function(e){var t=this.s;null!==t&&g.Obsolete(t),this.c=e}},null,M)).Create=function(e){var t=null;return t=M.New(e,null,function(){var e=t.s;return null===e&&(e=g.Copy(t.c()),t.s=e,g.WhenObsoleteRun(e,function(){t.s=null})),e})},M.New=function(e,t,n){return new M({c:e,s:t,v:n})},S.get_Do=function(){return T.B},S.Apply=function(e,t){return S.Map2(function(e,t){return e(t)},e,t)},S.AsyncAwait=function(r,u){return ze.FromContinuations(function(e,t,n){return function(t){var n;n=Qe.Create(function(){return S.RemovableSink(function(e){r(e)&&(Qe.Force(n)(),t(e))},u)}),Qe.Force(n)}.apply(null,[e,t,n])})},S.RemovableSink=function(t,n){var r;return r=[!0],ze.scheduler().Fork(function e(){g.WhenRun(n(),function(e){r[0]&&t(e)},function(){r[0]&&ze.scheduler().Fork(e)})}),function(){r[0]=!1}},S.Sink=function(t,n){ze.scheduler().Fork(function e(){g.WhenRun(n(),t,function(){ze.scheduler().Fork(e)})})},S.TryFinally=function(e,t){return S.CreateLazy(function(){try{return t()}finally{e()}})},S.TryWith=function(t,e){return S.CreateLazy(function(){try{return e()}catch(e){return t(e)()}})},S.ConstAsync=function(e){var t=g.CreateForeverAsync(e);return function(){return t}},S.Const=function(e){var t=g.New({$:0,$0:e});return function(){return t}},S.Sequence=function(e){return S.CreateLazy(function(){return g.Sequence(Oe.map(function(e){return e()},e))})},S.UpdateWhile=function(e,t,n){var r=[e];return S.BindInner(function(e){return e?S.Map(function(e){return r[0]=e},n):S.Const(r[0])},t)},S.BindInner=function(e,t){return S.JoinInner(S.Map(e,t))},S.JoinInner=function(e){return S.CreateLazy(function(){return g.JoinInner(e())})},S.Bind=function(e,t){return S.Join(S.Map(e,t))},S.Join=function(e){return S.CreateLazy(function(){return g.Join(e())})},S.MapSeqCachedView=function(n,e){return S.MapSeqCachedViewBy(N.id,function(e,t){return n(t)},e)},S.MapSeqCachedViewBy=function(i,o,e){var t=[new Ye.New$5];return S.Map(function(e){var r=t[0],u=new Ye.New$5,e=f.mapInPlace(function(e){var t,n=i(e),e=r.ContainsKey(n)?(t=r.get_Item(n),I.Set(t.r,e),t):S.ConvertSeqNode(function(e){return o(n,e)},e);return u.set_Item(n,e),e.e},Ue.ofSeq(e));return t[0]=u,e},e)},S.ConvertSeqNode=function(e,t){var n=I.Create$1(t),t=n.get_View();return{e:e(t),r:n,w:t}},S.MapSeqCached=function(e,t){return S.MapSeqCachedBy(N.id,e,t)},S.MapSeqCachedBy=function(u,i,e){var t=[new Ye.New$5];return S.Map(function(e){var n=t[0],r=new Ye.New$5,e=f.mapInPlace(function(e){var t=u(e),e=n.ContainsKey(t)?n.get_Item(t):i(e);return r.set_Item(t,e),e},Ue.ofSeq(e));return t[0]=r,e},e)},S.SnapshotOn=function(e,t,n){var r=g.New({$:2,$0:e,$1:[]});return S.CreateLazy(function(){return null==r.s?g.SnapshotOn(t(),n()):(g.WhenObsolete(t(),r),r)})},S.GetAsync=function(t){return ze.FromContinuations(function(e){return S.Get(e,t)})},S.WithInitOption=function(e){return S.CreateLazy(function(){return g.WithInitOption(e())})},S.WithInit=function(e,t){return S.CreateLazy(function(){return g.WithInit(e,t())})},S.Get=function(t,n){var r;r=[!1],function e(){g.WhenRun(n(),function(e){r[0]||(r[0]=!0,t(e))},function(){r[0]||e()})}()},S.TryGet=function(e){return g.TryGet(e())},S.MapAsync2=function(e,t,n){return S.MapAsync(N.id,S.Map2(e,t,n))},S.MapAsync=function(e,t){return S.CreateLazy(function(){return g.MapAsync(e,t())})},S.Map3=function(e,t,n,r){return S.CreateLazy(function(){return g.Map3(e,t(),n(),r())})},S.Map2Unit=function(e,t){return S.CreateLazy(function(){return g.Map2Unit(e(),t())})},S.Map2=function(e,t,n){return S.CreateLazy(function(){return g.Map2(e,t(),n())})},S.MapCached=function(e,t){return S.MapCachedBy(He.Equals,e,t)},S.MapCachedBy=function(e,t,n){var r=[null];return S.CreateLazy(function(){return g.MapCachedBy(e,r,t,n())})},S.Map=function(e,t){return S.CreateLazy(function(){return g.Map(e,t())})},S.CreateLazy=function(e){var n={c:null,o:e};return function(){var e,t=n.c;return null===t&&(t=n.o(),null!=(e=(n.c=t).s)&&0==e.$?n.o=null:g.WhenObsoleteRun(t,function(){n.c=null})),t}},(b=t.FromView=We.Class({get_Id:function(){return"uinref"+N.String(this.id)},SetFinal:function(e){this.set(e)},Update:function(t){var n;S.Get((n=this.set,function(e){return n(t(e))}),this.view)},UpdateMaybe:function(t){var n=this;S.Get(function(e){e=t(e);null!=e&&1==e.$&&n.set(e.$0)},this.view)},Set:function(e){this.set(e)},Get:function(){return this.current},get_View:function(){return this.view}},w,b)).New=We.Ctor(function(e,t){var n=this;w.New.call(this),this.set=t,this.id=d.Int(),this.current=null==(t=S.TryGet(e))?null:t.$0,this.view=S.Map(function(e){return n.current=e},e)},b),T.B={$:0},(F=t.Submitter=We.Class({Trigger:function(){this.var.Set(null)}},o,F)).New=We.Ctor(function(e,t){o.New.call(this),this.input=e,this.var=I.Create(),this.view=S.SnapshotOn(t,this.var.get_View(),this.input)},F),F.CreateOption=function(e){return new F.New(S.Map(function(e){return{$:1,$0:e}},e),null)},k.Fresh=function(){return{$:0,$0:d.Int()}},(V=t.Model=We.Class({},o,V)).New=We.Ctor(function(e,t){t=I.Create$1(t);V.New$1.call(this,t,S.Map(e,t.get_View()))},V),V.New$1=We.Ctor(function(e,t){o.New.call(this),this.var=e,this.view=t},V),V.Update=function(t,e){I.Update(e.var,function(e){return t(e),e})},V.Create=function(e,t){return new V.New(e,t)},L.Default=function(){return B.$cctor(),B.Default},(_=R.ArrayStorage=We.Class({SSet:function(e){return Ue.ofSeq(e)},SSetAt:function(e,t,n){return Ue.set(n,e,t),n},SRemoveIf:function(t,e){return Ue.filter(function(e){return!t(e)},e)},SInit:function(){return this.init},SPrependMany:function(e,t){e=f.ofSeqNonCopying(e);return t.unshift.apply(t,e),t},SPrepend:function(e,t){return t.unshift(e),t},SAppendMany:function(e,t){e=f.ofSeqNonCopying(e);return t.push.apply(t,e),t},SAppend:function(e,t){return t.push(e),t}},o,_)).New=We.Ctor(function(e){o.New.call(this),this.init=e},_),(x=R.LocalStorageBackend=We.Class({clear:function(){this.storage.removeItem(this.id)},set:function(e){return this.storage.setItem(this.id,et.stringify(Ue.map(this.serializer.Encode,e))),e},SSet:function(e){return this.set(Ue.ofSeq(e))},SSetAt:function(e,t,n){return Ue.set(n,e,t),this.set(n)},SRemoveIf:function(t,e){return this.set(Ue.filter(function(e){return!t(e)},e))},SInit:function(){var e=this.storage.getItem(this.id);if(null===e)return[];try{return Ue.map(this.serializer.Decode,et.parse(e))}catch(e){return[]}},SPrependMany:function(e,t){e=f.ofSeqNonCopying(e);return t.unshift.apply(t,e),this.set(t)},SPrepend:function(e,t){return t.unshift(e),this.set(t)},SAppendMany:function(e,t){e=f.ofSeqNonCopying(e);return t.push.apply(t,e),this.set(t)},SAppend:function(e,t){return t.push(e),this.set(t)}},o,x)).New=We.Ctor(function(e,t){o.New.call(this),this.id=e,this.serializer=t,this.storage=self.localStorage},x),R.LocalStorage=function(e,t){return new x.New(e,t)},R.InMemory=function(e){return new _.New(e)},(D=t.ListModel=We.Class({Wrap:function(e,t,n){return D.Wrap(this,e,t,n)},MapLens:function(n){var r=this;return S.MapSeqCachedViewBy(r.key,function(e,t){return n(e,r["LensInto'"](N.id,function(e,t){return t},e,t))},this.var.get_View())},Lens:function(e){return this.LensInto(N.id,function(e,t){return t},e)},LensInto:function(e,t,n){return this["LensInto'"](e,t,n,S.Map(e,this.FindByKeyAsView(n)))},"LensInto'":function(r,u,e,t){var i=this,n=d.Id(),o=new w({Get:function(){return r(i.FindByKey(e))},Set:function(t){return i.UpdateBy(function(e){return{$:1,$0:u(e,t)}},e)},SetFinal:function(e){return this.Set(e)},Update:function(t){return i.UpdateBy(function(e){return{$:1,$0:u(e,t(r(e)))}},e)},UpdateMaybe:function(n){return i.UpdateBy(function(e){var t=n(r(e));return null==t?null:{$:1,$0:u(e,t.$0)}},e)},get_View:function(){return t},get_Id:function(){return n}});return w.New.call(o),o},get_LengthAsView:function(){return S.Map(Ue.length,this.var.get_View())},get_Length:function(){return Ue.length(this.var.Get())},Clear:function(){this.var.Set(this.storage.SSet([])),this.ObsoleteAll()},UpdateBy:function(e,t){var n=this,r=this.var.Get(),u=Ue.tryFindIndex(function(e){return He.Equals(n.key(e),t)},r);null!=u&&1==u.$&&(u=u.$0,null!=(e=e(Ue.get(r,u)))&&1==e.$&&(this.var.Set(this.storage.SSetAt(u,e.$0,r)),this.ObsoleteKey(t)))},UpdateAll:function(r){var e=this;this.var.Update(function(n){return Ue.iteri(function(e,t){t=r(t);return null==t?null:Ue.set(n,e,t.$0)},n),e.storage.SSet(n)}),this.ObsoleteAll()},FindByKeyAsView:function(e){return S.Map(function(e){return e.$0},this.TryFindByKeyAsView(e))},TryFindByKeyAsView:function(n){var r=this;return function(){var t=null,e=[r.it.TryGetValue(n,{get:function(){return t},set:function(e){t=e}}),t];return e[0]?e[1]:(e=g.New({$:2,$0:r.TryFindByKey(n),$1:[]}),r.it.Add(n,e),e)}},TryFindByKey:function(t){var n=this;return Ue.tryFind(function(e){return He.Equals(n.key(e),t)},this.var.Get())},FindByKey:function(t){var n=this;return Ue.find(function(e){return He.Equals(n.key(e),t)},this.var.Get())},TryFindAsView:function(t){return S.Map(function(e){return Ue.tryFind(t,e)},this.var.get_View())},FindAsView:function(t){return S.Map(function(e){return Ue.find(t,e)},this.var.get_View())},TryFind:function(e){return Ue.tryFind(e,this.var.Get())},Find:function(e){return Ue.find(e,this.var.Get())},ContainsKeyAsView:function(t){var n;function r(e){return He.Equals(n.key(e),t)}return S.Map(function(e){return Ue.exists(r,e)},(n=this).var.get_View())},ContainsKey:function(t){var n=this;return Ue.exists(function(e){return He.Equals(n.key(e),t)},this.var.Get())},Set:function(e){this.var.Set(this.storage.SSet(e)),this.ObsoleteAll()},Iter:function(e){Ue.iter(e,this.var.Get())},RemoveByKey:function(t){var n=this;this.var.Set(this.storage.SRemoveIf(function(e){return He.Equals(n.key(e),t)},this.var.Get())),this.ObsoleteKey(t)},RemoveBy:function(e){for(var t,n=this.var.Get(),r=0,u=n.length-1;r<=u;r++)e(t=Ue.get(n,r))&&this.ObsoleteKey(this.key(t));this.var.Set(this.storage.SRemoveIf(e,this.var.Get()))},Remove:function(e){var t,n,r=this.var.Get();U.Contains(this.key,e,r)&&(t=this.key,n=t(e),this.var.Set(this.storage.SRemoveIf(function(e){return He.Equals(t(e),n)},r)),this.ObsoleteKey(n))},PrependMany:function(e){var u,i;(u=this).var.Set(this.storage.SPrependMany(i=[],We.Curried3(Oe.fold)(function(e,t){var n,r=u.key(t);return u.ObsoleteKey(r),null==(n=Ue.tryFindIndex(function(e){return He.Equals(u.key(e),r)},e))?(i.push(t),e):u.storage.SSetAt(n.$0,t,e)})(this.var.Get())(e)))},Prepend:function(e){var t=this,n=this.var.Get(),r=this.key(e),u=Ue.tryFindIndex(function(e){return He.Equals(t.key(e),r)},n);null!=u&&1==u.$?this.var.Set(this.storage.SSetAt(u.$0,e,n)):this.var.Set(this.storage.SPrepend(e,n)),this.ObsoleteKey(r)},AppendMany:function(e){var u,i;(u=this).var.Set(this.storage.SAppendMany(i=[],We.Curried3(Oe.fold)(function(e,t){var n,r=u.key(t);return u.ObsoleteKey(r),null==(n=Ue.tryFindIndex(function(e){return He.Equals(u.key(e),r)},e))?(i.push(t),e):u.storage.SSetAt(n.$0,t,e)})(this.var.Get())(e)))},Append:function(e){var t=this,n=this.var.Get(),r=this.key(e),u=Ue.tryFindIndex(function(e){return He.Equals(t.key(e),r)},n);null!=u&&1==u.$?this.var.Set(this.storage.SSetAt(u.$0,e,n)):this.var.Set(this.storage.SAppend(e,n)),this.ObsoleteKey(r)},ObsoleteAll:function(){Oe.iter(function(e){g.Obsolete(e.V)},this.it),this.it.Clear()},ObsoleteKey:function(e){var t=null,n=[this.it.TryGetValue(e,{get:function(){return t},set:function(e){t=e}}),t];n[0]&&(g.Obsolete(n[1]),this.it.Remove(e))},GetEnumerator0:function(){return Be.Get0(this.var.Get())},GetEnumerator:function(){return Be.Get(this.var.Get())}},o,D)).New=We.Ctor(function(e,t){D.New$3.call(this,e,I.Create$1(Ue.ofSeq(Oe.distinctBy(e,t.SInit()))),t)},D),D.New$1=We.Ctor(function(e){D.New$2.call(this,e,[])},D),D.New$2=We.Ctor(function(e,t){t=Ue.ofSeq(t);D.New$3.call(this,e,I.Create$1(t),R.InMemory(t))},D),D.New$3=We.Ctor(function(e,t,n){o.New.call(this),this.key=e,this.var=t,this.storage=n,this.v=S.Map(function(e){return e.slice()},this.var.get_View()),this.it=new Ye.New$5},D),U.Contains=function(t,e,n){var r=t(e);return Ue.exists(function(e){return He.Equals(t(e),r)},n)},D.Wrap=function(r,u,i,o){var a=[new Ye.New$5],e=Ue.map(function(e){var t=i(e);return a[0].set_Item(r.key(e),t),t},r.var.Get());return new D.New$3(function(e){return r.key(u(e))},I.Lens(r.var,function(e){var n=new Ye.New$5,e=Ue.map(function(e){var t=r.key(e),e=a[0].ContainsKey(t)?o(a[0].get_Item(t),e):i(e);return n.set_Item(t,e),e},e);return a[0]=n,e},function(e,t){var n=new Ye.New$5,t=Ue.map(function(e){var t=u(e);return n.set_Item(r.key(t),e),t},t);return a[0]=n,t}),R.InMemory(e))},D.FromSeq=function(e){return D.Create(N.id,e)},D.Create=function(e,t){return D.CreateWithStorage(e,R.InMemory(Ue.ofSeq(t)))},D.CreateWithStorage=function(e,t){return new D.New(e,t)},B.$cctor=function(){B.$cctor=N.ignore,B.Default={Encode:N.id,Decode:N.id}},(P=t.ReactiveExtensions=We.Class({},o,P)).New=We.Ctor(function(){o.New.call(this)},P),(G=t.DoubleInterpolation=We.Class({Interpolate:function(e,t,n){return t+e*(n-t)}},null,G)).DoubleInterpolation=new G({$:0}),q.get_Double=function(){return G.DoubleInterpolation},(O=t.Easing=We.Class({TransformTime:function(e){return this.transformTime(e)}},o,O)).get_CubicInOut=function(){return W.CubicInOut()},O.Custom=function(e){return new O.New(e)},O.New=We.Ctor(function(e){o.New.call(this),this.transformTime=e},O),W.CubicInOut=function(){return j.$cctor(),j.CubicInOut},H.get_Empty=function(){return{$:0,$0:p.Empty()}},H.WhenDone=function(e,t){return H.Append({$:0,$0:p.Single({$:0,$0:e})},t)},H.Run=function(u,i){var o;function r(r){N.requestAnimationFrame(function(e){!function t(n,e){e-=n;return i.Compute(e),u(),e<=o?void N.requestAnimationFrame(function(e){t(n,e)}):r()}(e,e)})}return 0===(o=i.Duration)?ze.Zero():ze.FromContinuations(function(e,t,n){return r.apply(null,[e,t,n])})},H.Play=function(e){return ze.Delay(function(){return ze.Bind(H.Run(N.ignore,K.Actions(e)),function(){return K.Finalize(e),ze.Return(null)})})},H.Pack=function(e){return{$:0,$0:p.Single({$:1,$0:e})}},H.Map=function(t,e){var n;return K.Def(e.Duration,(n=e.Compute,function(e){return t(n(e))}))},H.Delayed=function(t,n,r,u,i,o){return{Compute:function(e){return e<=u?i:t.Interpolate(n.TransformTime((e-u)/r),i,o)},Duration:r+u}},H.Simple=function(t,n,r,u,i){return{Compute:function(e){return t.Interpolate(n.TransformTime(e/r),u,i)},Duration:r}},H.Const=function(e){return K.Const(e)},H.Concat=function(e){return{$:0,$0:p.Concat(Oe.map(K.List,e))}},H.Append=function(e,t){return{$:0,$0:p.Append(e.$0,t.$0)}},H.set_UseAnimations=function(e){K.set_UseAnimations(e)},H.get_UseAnimations=function(){return K.UseAnimations()},K.UseAnimations=function(){return j.$cctor(),j.UseAnimations},K.set_UseAnimations=function(e){j.$cctor(),j.UseAnimations=e},K.Actions=function(e){return K.ConcatActions(Ue.choose(function(e){return 1==e.$?{$:1,$0:e.$0}:null},p.ToArray(e.$0)))},K.ConcatActions=function(e){var t,n,r=f.ofSeqNonCopying(e),e=Ue.length(r);return 0===e?K.Const():1===e?Ue.get(r,0):(t=Oe.max(Oe.map(function(e){return e.Duration},r)),n=Ue.map(function(e){return K.Prolong(t,e)},r),K.Def(t,function(t){Ue.iter(function(e){e.Compute(t)},n)}))},K.Prolong=function(e,t){var n=t.Compute,r=t.Duration,u=Qe.Create(function(){return t.Compute(t.Duration)});return{Compute:function(e){return r<=e?u.f():n(e)},Duration:e}},K.Const=function(e){return K.Def(0,function(){return e})},K.Def=function(e,t){return{Compute:t,Duration:e}},K.Finalize=function(e){Ue.iter(function(e){0==e.$&&e.$0()},p.ToArray(e.$0))},K.List=function(e){return e.$0},(z=t.Trans=We.Class({Copy:function(e,t,n,r){var u,i;return i=null==e?function(n){return function(e){return t=n,e=e,u.TChange(t,e);var t}}:e.$0,new z.New$3(function(e,t){return i(e)(t)},(e=(u=this).get_TEnter(),null==t?e:t.$0),(t=this.get_TExit(),null==n?t:n.$0),(n=this.get_TFlags(),null==r?n:r.$0))},get_TFlags:function(){return this.flags},get_TExit:function(){return this.exit},get_TEnter:function(){return this.enter},TChange:function(e,t){return this.change(e,t)}},o,z)).New=We.Ctor(function(e,t,n){z.New$3.call(this,e,He.Equals(t,null)?H.Const:t,He.Equals(n,null)?H.Const:n,1|(He.Equals(t,null)?0:2)|(He.Equals(n,null)?0:4))},z),z.New$1=We.Ctor(function(e){z.New$3.call(this,e,H.Const,H.Const,1)},z),z.New$2=We.Ctor(function(){z.New$3.call(this,function(e,t){return H.Const(t)},H.Const,H.Const,0)},z),z.New$3=We.Ctor(function(e,t,n,r){o.New.call(this),this.change=e,this.enter=t,this.exit=n,this.flags=r},z),z.Exit=function(e,t){return t.Copy(null,null,{$:1,$0:e},{$:1,$0:4|t.get_TFlags()})},z.Enter=function(e,t){return t.Copy(null,{$:1,$0:e},null,{$:1,$0:2|t.get_TFlags()})},z.Change=function(e,t){return t.Copy({$:1,$0:e},null,null,{$:1,$0:1|t.get_TFlags()})},z.Create=function(e){return new z.New$1(e)},z.Trivial=function(){return new z.New$2},z.CanAnimateExit=function(e){return 4==(4&e.get_TFlags())},z.CanAnimateEnter=function(e){return 2==(2&e.get_TFlags())},z.CanAnimateChange=function(e){return 1==(1&e.get_TFlags())},z.AnimateExit=function(e,t){return e.get_TExit()(t)},z.AnimateEnter=function(e,t){return e.get_TEnter()(t)},z.AnimateChange=function(e,t,n){return e.TChange(t,n)},j.$cctor=function(){j.$cctor=N.ignore,j.CubicInOut=O.Custom(function(e){var t=e*e;return 3*t-t*e*2}),j.UseAnimations=!0},t.OnAfterRenderControl=We.Class({get_Body:function(){for(var e,t,n,r=self.document.querySelectorAll("[ws-runafterrender]"),u=0,i=r.length-1;u<=i;u++)t=r[u],n=N.eval(t.getAttribute("ws-runafterrender")),t.removeAttribute("ws-runafterrender"),n(t);return o.New.call(e={ReplaceInDom:function(){return null}}),e}},X,Z),(Q=t.AnimatedAttrNode=We.Class({sync:function(e){var t;this.dirty&&(null!=(t=this.logical)&&this.push(e)(t.$0),this.visible=this.logical,this.dirty=!1)},pushVisible:function(e,t){this.visible={$:1,$0:t},this.dirty=!0,this.push(e)(t)},NChanged:function(){return this.updates},NSync:N.ignore,NGetExitAnim:function(t){var e,n=this;return H.WhenDone(function(){n.dirty=!0,n.visible=null},null!=(e=this.visible)&&1==e.$?H.Pack(H.Map(function(e){n.pushVisible(t,e)},z.AnimateExit(this.tr,e.$0))):H.get_Empty())},NGetEnterAnim:function(t){var e,n,r,u=this;return H.WhenDone(function(){u.sync(t)},(e=this.visible,n=this.logical,null!=e&&1==e.$&&null!=n&&1==n.$&&this.dirty&&(r=[n.$0,e.$0])?H.Pack(H.Map(function(e){u.pushVisible(t,e)},z.AnimateChange(this.tr,r[1],r[0]))):null==e&&null!=n&&1==n.$?H.Pack(H.Map(function(e){u.pushVisible(t,e)},z.AnimateEnter(this.tr,n.$0))):H.get_Empty()))},NGetChangeAnim:function(t){var e,n,r,u=this;return H.WhenDone(function(){u.sync(t)},(e=this.visible,n=this.logical,null!=e&&1==e.$&&null!=n&&1==n.$&&this.dirty&&(r=[n.$0,e.$0])?H.Pack(H.Map(function(e){u.pushVisible(t,e)},z.AnimateChange(this.tr,r[1],r[0]))):H.get_Empty()))}},o,Q)).New=We.Ctor(function(e,t,n){var r=this;o.New.call(this),this.tr=e,this.push=n,this.logical=null,this.visible=null,this.dirty=!0,this.updates=S.Map(function(e){r.logical={$:1,$0:e},r.dirty=!0},t)},Q),(Y=t.DynamicAttrNode=We.Class({NChanged:function(){return this.updates},NSync:function(e){this.dirty&&(this.push(e)(this.value),this.dirty=!1)},NGetExitAnim:function(e){return H.get_Empty()},NGetEnterAnim:function(e){return H.get_Empty()},NGetChangeAnim:function(e){return H.get_Empty()}},o,Y)).New=We.Ctor(function(e,t){var n=this;o.New.call(this),this.push=t,this.value=void 0,this.dirty=!1,this.updates=S.Map(function(e){n.value=e,n.dirty=!0},e)},Y),(ee=t.AttrProxy=We.Class({},null,ee)).Handler=function(e,t){return ee.HandlerImpl(e,t)},ee.HandlerImpl=function(e,n){return ue.Static(function(t){t.addEventListener(e,function(e){return n(t)(e)},!1)})},ee.OnAfterRenderImpl=function(e){return new ee({$:4,$0:e})},ee.Concat=function(e){e=f.ofSeqNonCopying(e);return f.TreeReduce(ue.EmptyAttr(),ee.Append,e)},ee.Append=function(e,t){return ue.AppendTree(e,t)},ee.Create=function(t,n){return ue.Static(function(e){e.setAttribute(t,n)})},re.New=function(e,t,n,r){n={DynElem:e,DynFlags:t,DynNodes:n};return We.SetOptional(n,"OnAfterRender",r),n},ue.Static=function(e){return new ee({$:3,$0:e})},ue.Dynamic=function(e,t){return new ee({$:1,$0:new Y.New(e,t)})},ue.Animated=function(e,t,n){var t=new Q.New(e,t,n),n=4;return z.CanAnimateEnter(e)&&(n|=1),z.CanAnimateExit(e)&&(n|=2),t=new ee({$:1,$0:t}),ue.SetFlags(t,n),t},ue.EmptyAttr=function(){return le.$cctor(),le.EmptyAttr},ue.AppendTree=function(e,t){var n;return null===e?t:null===t?e:(n=new ee({$:2,$0:e,$1:t}),ue.SetFlags(n,ue.Flags(e)|ue.Flags(t)),n)},ue.GetChangeAnim=function(e){return ue.GetAnim(e,function(e,t){return e.NGetChangeAnim(t)})},ue.GetExitAnim=function(e){return ue.GetAnim(e,function(e,t){return e.NGetExitAnim(t)})},ue.GetEnterAnim=function(e){return ue.GetAnim(e,function(e,t){return e.NGetEnterAnim(t)})},ue.GetAnim=function(t,n){return H.Concat(Ue.map(function(e){return n(e,t.DynElem)},t.DynNodes))},ue.Updates=function(e){return f.MapTreeReduce(function(e){return e.NChanged()},S.Const(),S.Map2Unit,e.DynNodes)},ue.Empty=function(e){return re.New(e,0,[],null)},ue.Insert=function(n,e){var r,u,t;return r=[],u=[],function e(t){null!==t&&(null!=t&&1==t.$?r.push(t.$0):null!=t&&2==t.$?(e(t.$0),e(t.$1)):null!=t&&3==t.$?t.$0(n):null!=t&&4==t.$&&u.push(t.$0))}(e),t=r.slice(0),re.New(n,ue.Flags(e),t,0===u.length?null:{$:1,$0:function(t){Oe.iter(function(e){e(t)},u)}})},ue.Sync=function(t,e){Ue.iter(function(e){e.NSync(t)},e.DynNodes)},ue.SetFlags=function(e,t){e.flags=t},ue.Flags=function(e){return null!==e&&e.hasOwnProperty("flags")?e.flags:0},ue.HasExitAnim=function(e){return 2==(2&e.DynFlags)},ue.HasEnterAnim=function(e){return 1==(1&e.DynFlags)},ue.HasChangeAnim=function(e){return 4==(4&e.DynFlags)},(ie=t.CheckedInput=We.Class({get_Input:function(){return 1==this.$||2==this.$?this.$0:this.$1}},null,ie)).Make=function(e){return new ie({$:0,$0:e,$1:N.String(e)})},oe.FloatApplyChecked=function(){return le.$cctor(),le.FloatApplyChecked},oe.FloatGetChecked=function(){return le.$cctor(),le.FloatGetChecked},oe.FloatSetChecked=function(){return le.$cctor(),le.FloatSetChecked},oe.FloatApplyUnchecked=function(){return le.$cctor(),le.FloatApplyUnchecked},oe.FloatGetUnchecked=function(){return le.$cctor(),le.FloatGetUnchecked},oe.FloatSetUnchecked=function(){return le.$cctor(),le.FloatSetUnchecked},oe.IntApplyChecked=function(){return le.$cctor(),le.IntApplyChecked},oe.IntGetChecked=function(){return le.$cctor(),le.IntGetChecked},oe.IntSetChecked=function(){return le.$cctor(),le.IntSetChecked},oe.IntApplyUnchecked=function(){return le.$cctor(),le.IntApplyUnchecked},oe.IntGetUnchecked=function(){return le.$cctor(),le.IntGetUnchecked},oe.IntSetUnchecked=function(){return le.$cctor(),le.IntSetUnchecked},oe.StringApply=function(){return le.$cctor(),le.StringApply},oe.StringGet=function(){return le.$cctor(),le.StringGet},oe.StringSet=function(){return le.$cctor(),le.StringSet},oe.BoolCheckedApply=function(){return le.$cctor(),le.BoolCheckedApply},oe.ApplyValue=function(u,r,t,e,n){return[e(function(r){function e(){t.UpdateMaybe(function(e){var t,n=u(r);return null!=n&&1==n.$&&!He.Equals(n.$0,e)&&(t=[n,n.$0])?t[0]:null})}r.addEventListener("change",e),r.addEventListener("input",e),r.addEventListener("keypress",e)}),n(function(n){return function(e){var t=u(n);return null!=t&&1==t.$&&He.Equals(t.$0,e)&&(t.$0,1)?null:r(n,e)}})]},ae.ValidateForm=function(){return ae.OnAfterRender(function(e){self.H5F&&self.H5F.setup(e)})},ae.Checked=function(t){var e=oe.BoolCheckedApply()(t)(ue.Static)(function(e){return ae.DynamicCustom(e,t.get_View())});return ee.Append(e[0],e[1])},ae.FloatValue=function(t){var e=oe.FloatApplyChecked()(t)(ue.Static)(function(e){return ae.DynamicCustom(e,t.get_View())});return ee.Append(e[0],e[1])},ae.FloatValueUnchecked=function(t){var e=oe.FloatApplyUnchecked()(t)(ue.Static)(function(e){return ae.DynamicCustom(e,t.get_View())});return ee.Append(e[0],e[1])},ae.IntValue=function(t){var e=oe.IntApplyChecked()(t)(ue.Static)(function(e){return ae.DynamicCustom(e,t.get_View())});return ee.Append(e[0],e[1])},ae.IntValueUnchecked=function(t){var e=oe.IntApplyUnchecked()(t)(ue.Static)(function(e){return ae.DynamicCustom(e,t.get_View())});return ee.Append(e[0],e[1])},ae.Value=function(t){var e=oe.StringApply()(t)(ue.Static)(function(e){return ae.DynamicCustom(e,t.get_View())});return ee.Append(e[0],e[1])},ae.ContentEditableHtml=function(e){e=ae.CustomVar(e,function(e,t){e.innerHTML=t},function(e){return{$:1,$0:e.innerHTML}});return ee.Append(ee.Create("contenteditable","true"),e)},ae.ContentEditableText=function(e){e=ae.CustomVar(e,function(e,t){e.textContent=t},function(e){return{$:1,$0:e.textContent}});return ee.Append(ee.Create("contenteditable","true"),e)},ae.CustomValue=function(e,n,t){return ae.CustomVar(e,function(e,t){e.value=n(t)},function(e){return t(e.value)})},ae.CustomVar=function(t,e,n){e=oe.ApplyValue(n,e,t,ue.Static,function(e){return ae.DynamicCustom(e,t.get_View())});return ee.Append(e[0],e[1])},ae.DynamicProp=function(n,e){return ue.Dynamic(e,function(t){return function(e){t[n]=e}})},ae.Prop=function(t,n){return ue.Static(function(e){e[t]=n})},ae.DynamicPred=function(r,e,t){return ue.Dynamic(S.Map2(function(e,t){return[e,t]},e,t),function(n){return function(e){return t=n,(e=e)[0]?t.setAttribute(r,e[1]):t.removeAttribute(r);var t}})},ae.DynamicClass=function(e,t,n){return ae.DynamicClassPred(e,S.Map(n,t))},ae.Class=function(e){return ae.ClassPred(e,!0)},ae.ClassPred=function(t,n){return ue.Static(function(e){n?A.AddClass(e,t):A.RemoveClass(e,t)})},ae.DynamicClassPred=function(n,e){return ue.Dynamic(e,function(t){return function(e){return e?A.AddClass(t,n):A.RemoveClass(t,n)}})},ae.OnAfterRenderView=function(e,t){var n=d.Id();return ee.Append(ae.OnAfterRender(function(e){t(e,e[n])}),ae.DynamicCustom(function(t){return function(e){t[n]=e}},e))},ae.OnAfterRender=function(e){return new ee({$:4,$0:e})},ae.HandlerView=function(n,r,u){return ue.Static(function(e){var t=u(e);e.addEventListener(n,function(e){return S.Get(t(e),r)},!1)})},ae.Handler=function(e,n){return ue.Static(function(t){t.addEventListener(e,function(e){return n(t)(e)},!1)})},ae.DynamicStyle=function(n,e){return ue.Dynamic(e,function(t){return function(e){return t.style.setProperty(n,e)}})},ae.DynamicCustom=function(e,t){return ue.Dynamic(t,e)},ae.Dynamic=function(n,e){return ue.Dynamic(e,function(t){return function(e){return t.setAttribute(n,e)}})},ae.AnimatedStyle=function(n,e,t,r){return ue.Animated(e,t,function(t){return function(e){e=r(e);return t.style.setProperty(n,e)}})},ae.Animated=function(n,e,t,r){return ue.Animated(e,t,function(t){return function(e){return t.setAttribute(n,r(e))}})},ae.Style=function(t,n){return ue.Static(function(e){e.style.setProperty(t,n)})},le.$cctor=function(){var n,r,u,i,e,o;le.$cctor=N.ignore,le.EmptyAttr=null,le.BoolCheckedApply=We.Curried3(function(t,e,n){return[e(function(e){e.addEventListener("change",function(){return He.Equals(t.Get(),e.checked)?null:t.Set(e.checked)})}),n(function(t){return function(e){t.checked=e}})]}),le.StringSet=function(t){return function(e){t.value=e}},le.StringGet=function(e){return{$:1,$0:e.value}},le.StringApply=(e=oe.StringGet(),n=oe.StringSet(),We.Curried(oe.ApplyValue,3,[e,function(e,t){return n(e)(t)}])),le.IntSetUnchecked=function(t){return function(e){t.value=N.String(e)}},le.IntGetUnchecked=function(e){var e=e.value;return a.isBlank(e)?{$:1,$0:0}:(e=+e)!=e>>0?null:{$:1,$0:e}},le.IntApplyUnchecked=(e=oe.IntGetUnchecked(),r=oe.IntSetUnchecked(),We.Curried(oe.ApplyValue,3,[e,function(e,t){return r(e)(t)}])),le.IntSetChecked=function(t){return function(e){e=e.get_Input();return t.value!==e?void(t.value=e):null}},le.IntGetChecked=function(e){var t,n=e.value;return{$:1,$0:a.isBlank(n)?!e.checkValidity||e.checkValidity()?new ie({$:2,$0:n}):new ie({$:1,$0:n}):(t=0,e=[tt.TryParseInt32(n,{get:function(){return t},set:function(e){t=e}}),t],new ie(e[0]?{$:0,$0:e[1],$1:n}:{$:1,$0:n}))}},le.IntApplyChecked=(e=oe.IntGetChecked(),u=oe.IntSetChecked(),We.Curried(oe.ApplyValue,3,[e,function(e,t){return u(e)(t)}])),le.FloatSetUnchecked=function(t){return function(e){t.value=N.String(e)}},le.FloatGetUnchecked=function(e){var e=e.value;return a.isBlank(e)?{$:1,$0:0}:N.isNaN(e=+e)?null:{$:1,$0:e}},le.FloatApplyUnchecked=(e=oe.FloatGetUnchecked(),i=oe.FloatSetUnchecked(),We.Curried(oe.ApplyValue,3,[e,function(e,t){return i(e)(t)}])),le.FloatSetChecked=function(t){return function(e){e=e.get_Input();return t.value!==e?void(t.value=e):null}},le.FloatGetChecked=function(e){var t=e.value;return{$:1,$0:a.isBlank(t)?!e.checkValidity||e.checkValidity()?new ie({$:2,$0:t}):new ie({$:1,$0:t}):N.isNaN(e=+t)?new ie({$:1,$0:t}):new ie({$:0,$0:e,$1:t})}},le.FloatApplyChecked=(e=oe.FloatGetChecked(),o=oe.FloatSetChecked(),We.Curried(oe.ApplyValue,3,[e,function(e,t){return o(e)(t)}]))},ce.BatchUpdatesEnabled=function(){return Ce.$cctor(),Ce.BatchUpdatesEnabled},ce.set_BatchUpdatesEnabled=function(e){Ce.$cctor(),Ce.BatchUpdatesEnabled=e},(se=t.DocElemNode=We.Class({GetHashCode:function(){return this.ElKey},Equals:function(e){return this.ElKey===e.ElKey}},null,se)).New=function(e,t,n,r,u,i){return new se((We.SetOptional(u={Attr:e,Children:t,El:r,ElKey:u},"Delimiters",n),We.SetOptional(u,"Render",i),u))},de.FoldBack=function(e,t,n){return Ue.foldBack(e,t.$0,n)},de.Iter=function(e,t){Ue.iter(e,t.$0)},de.Except=function(e,t){var n=e.$0;return{$:0,$0:Ue.filter(function(t){return Ue.forall(function(e){return!(t===e)},n)},t.$0)}},de.DocChildren=function(e){var n;return n=[],function t(e){null!=e&&2==e.$?t(e.$0.Current):null!=e&&1==e.$?n.push(e.$0.El):null==e||(null!=e&&5==e.$?n.push(e.$0):null!=e&&4==e.$?n.push(e.$0.Text):null!=e&&6==e.$?Ue.iter(function(e){null==e||e.constructor===N.Object?t(e):n.push(e)},e.$0.Els):(t(e.$0),t(e.$1)))}(e.Children),{$:0,$0:f.ofSeqNonCopying(n)}},de.Children=function(e,t){var n,r,u;if(null==t||1!=t.$)return{$:0,$0:Ue.init(e.childNodes.length,(r=e.childNodes,function(e){return r[e]}))};for(u=[],n=t.$0[0].nextSibling;n!==t.$0[1];)u.push(n),n=n.nextSibling;return{$:0,$0:u}},$e.ToArray=function(e){return r.ToArray(e.$0)},$e.get_Empty=function(){return{$:0,$0:new qe.New$3}},$e.IsEmpty=function(e){return 0===e.$0.get_Count()},$e.Intersect=function(e,t){return{$:0,$0:r.Intersect(e.$0,t.$0)}},$e.Except=function(e,t){return{$:0,$0:r.Except(e.$0,t.$0)}},$e.FindAll=function(e){var t;function n(e){null!=e&&0==e.$?(n(e.$0),n(e.$1)):null!=e&&1==e.$?r(e.$0):null!=e&&2==e.$?n(e.$0.Current):null!=e&&6==e.$&&Ue.iter(r,e.$0.Holes)}function r(e){t.push(e),n(e.Children)}return t=[],n(e),{$:0,$0:new qe.New$2(t)}},$e.Filter=function(e,t){return{$:0,$0:r.Filter(e,t.$0)}},pe.New=function(e,t){return{PreviousNodes:e,Top:t}},he.UpdateTextNode=function(e,t){e.Value=t,e.Dirty=!0},he.CreateTextNode=function(){return{Text:self.document.createTextNode(""),Dirty:!1,Value:""}},he.UpdateEmbedNode=function(e,t){e.Current=t,e.Dirty=!0},he.CreateEmbedNode=function(){return{Current:null,Dirty:!1}},he.PerformSyncUpdate=function(e,t,n){n=$e.FindAll(n);he.SyncElemNode(e,t.Top),t.PreviousNodes=n},he.PerformAnimatedUpdate=function(r,u,i){return H.get_UseAnimations()?ze.Delay(function(){var e=$e.FindAll(i),t=he.ComputeChangeAnim(u,e),n=he.ComputeEnterAnim(u,e);return ze.Bind(H.Play(H.Append(t,he.ComputeExitAnim(u,e))),function(){return ze.Bind(he.SyncElemNodesNextFrame(r,u),function(){return ze.Bind(H.Play(n),function(){return u.PreviousNodes=e,ze.Return(null)})})})}):he.SyncElemNodesNextFrame(r,u)},he.SyncElemNodesNextFrame=function(r,u){return ce.BatchUpdatesEnabled()?ze.FromContinuations(function(e,t,n){return function(e){N.requestAnimationFrame(function(){he.SyncElemNode(r,u.Top),e()})}.apply(null,[e,t,n])}):(he.SyncElemNode(r,u.Top),ze.Return(null))},he.ComputeEnterAnim=function(e,t){return H.Concat(Ue.map(function(e){return ue.GetEnterAnim(e.Attr)},$e.ToArray($e.Except(e.PreviousNodes,$e.Filter(function(e){return ue.HasEnterAnim(e.Attr)},t)))))},he.ComputeChangeAnim=function(e,t){var n;function r(e){return ue.HasChangeAnim(e.Attr)}return n=function(e){return $e.Filter(r,e)},H.Concat(Ue.map(function(e){return ue.GetChangeAnim(e.Attr)},$e.ToArray($e.Intersect(n(e.PreviousNodes),n(t)))))},he.ComputeExitAnim=function(e,t){return H.Concat(Ue.map(function(e){return ue.GetExitAnim(e.Attr)},$e.ToArray($e.Except(t,$e.Filter(function(e){return ue.HasExitAnim(e.Attr)},e.PreviousNodes)))))},he.CreateDelimitedRunState=function(e,t,n){return pe.New($e.get_Empty(),he.CreateDelimitedElemNode(e,t,ue.EmptyAttr(),n))},he.CreateRunState=function(e,t){return pe.New($e.get_Empty(),he.CreateElemNode(e,ue.EmptyAttr(),t))},he.CreateDelimitedElemNode=function(e,t,n,r){var u=e.parentNode;return he.LinkPrevElement(t,r),n=ue.Insert(u,n),se.New(n,r,{$:1,$0:[e,t]},u,d.Int(),We.GetOptional(n.OnAfterRender))},he.CreateElemNode=function(e,t,n){return he.LinkElement(e,n),t=ue.Insert(e,t),se.New(t,n,null,e,d.Int(),We.GetOptional(t.OnAfterRender))},he.SyncElemNode=function(e,t){e||he.SyncElement(t),he.Sync(t.Children),he.AfterRender(t)},he.Sync=function(e){var t;null!=e&&1==e.$?he.SyncElemNode(!1,e.$0):null!=e&&2==e.$?he.Sync(e.$0.Current):null==e||null!=e&&5==e.$||(null!=e&&4==e.$?(t=e.$0).Dirty&&(t.Text.nodeValue=t.Value,t.Dirty=!1):null!=e&&6==e.$?(t=e.$0,Ue.iter(function(e){he.SyncElemNode(!1,e)},t.Holes),Ue.iter(function(e){ue.Sync(e[0],e[1])},t.Attrs),he.AfterRender(t)):(he.Sync(e.$0),he.Sync(e.$1)))},he.AfterRender=function(e){var t=We.GetOptional(e.Render);null!=t&&1==t.$&&(t.$0(e.El),We.SetOptional(e,"Render",null))},he.InsertBeforeDelim=function(e,t){var n=e.parentNode,r=self.document.createTextNode("");return n.insertBefore(r,e),he.LinkPrevElement(e,t),r},he.LinkPrevElement=function(e,t){he.InsertDoc(e.parentNode,t,e)},he.LinkElement=function(e,t){he.InsertDoc(e,t,null)},he.SyncElement=function(e){function r(e){return function e(t){var n;return null!=t&&0==t.$?e(t.$0)||e(t.$1):null!=t&&2==t.$?(n=t.$0).Dirty||e(n.Current):null!=t&&6==t.$&&((t=t.$0).Dirty||Ue.exists(r,t.Holes))}(e.Children)}ue.Sync(e.El,e.Attr),r(e)&&he.DoSyncElement(e)},he.DoSyncElement=function(e){var u,t;u=e.El,de.Iter((t=e.El,function(e){A.RemoveNode(t,e)}),de.Except(de.DocChildren(e),de.Children(e.El,We.GetOptional(e.Delimiters)))),function n(e,t){var r;return null!=e&&1==e.$?e.$0.El:null!=e&&2==e.$?(r=e.$0).Dirty?(r.Dirty=!1,he.InsertDoc(u,r.Current,t)):n(r.Current,t):null==e?t:null!=e&&4==e.$?e.$0.Text:null!=e&&5==e.$?e.$0:null!=e&&6==e.$?((r=e.$0).Dirty&&(r.Dirty=!1),Ue.foldBack(function(e,t){return null==e||e.constructor===N.Object?n(e,t):e},r.Els,t)):n(e.$0,n(e.$1,t))}(e.Children,null!=(e=We.GetOptional(e.Delimiters))&&1==e.$?e.$0[1]:null)},he.InsertDoc=function(n,e,t){var r;return null!=e&&1==e.$?he.InsertNode(n,e.$0.El,t):null!=e&&2==e.$?((r=e.$0).Dirty=!1,he.InsertDoc(n,r.Current,t)):null==e?t:null!=e&&4==e.$?he.InsertNode(n,e.$0.Text,t):null!=e&&5==e.$?he.InsertNode(n,e.$0,t):null!=e&&6==e.$?Ue.foldBack(function(e,t){return null==e||e.constructor===N.Object?he.InsertDoc(n,e,t):he.InsertNode(n,e,t)},e.$0.Els,t):he.InsertDoc(n,e.$0,he.InsertDoc(n,e.$1,t))},he.InsertNode=function(e,t,n){return A.InsertAt(e,n,t),t},(me=t.Doc=We.Class({ReplaceInDom:function(e){var t=self.document.createTextNode("");e.parentNode.replaceChild(t,e),me.RunBefore(t,this)}},o,me)).SvgElementMixed=function(e,t){t=me.MixedNodes(t);return me.SvgElement(e,t[0],t[1])},me.SvgElement=function(e,t,n){t=ee.Concat(t),n=me.Concat(n);return ye.New(self.document.createElementNS("http://www.w3.org/2000/svg",e),t,n)},me.ElementMixed=function(e,t){t=me.MixedNodes(t);return me.Element(e,t[0],t[1])},me.ConcatMixed=function(e){return me.Concat(Oe.map(me.ToMixedDoc,e))},me.MixedNodes=function(e){var t,n=[],r=[],u=Be.Get(e);try{for(;u.MoveNext();)(t=u.Current())instanceof ee?n.push(t):r.push(me.ToMixedDoc(t))}finally{"object"==typeof u&&"Dispose"in u&&u.Dispose()}return[n,r]},me.ToMixedDoc=function(e){return e instanceof me?e:"string"==typeof e?me.TextNode(e):e instanceof N.Element?me.StaticProxy(e):"function"==typeof e?me.EmbedView(S.Map(me.ToMixedDoc,e)):e instanceof w?me.EmbedView(S.Map(me.ToMixedDoc,e.get_View())):He.Equals(e,null)?me.get_Empty():me.TextNode(N.String(e))},me.Element=function(e,t,n){t=ee.Concat(t),n=me.Concat(n);return ye.New(self.document.createElement(e),t,n)},me.Radio=function(e,t,n){var r,u=self.document.createElement("input");return u.addEventListener("click",function(){return n.Set(t)},!1),r=ae.DynamicProp("checked",S.Map(function(e){return He.Equals(e,t)},n.get_View())),ye.New(u,ee.Concat(De.append(De.ofArray([ee.Create("type","radio"),ee.Create("name",n.get_Id()),r]),De.ofSeq(e))),me.get_Empty())},me.LinkView=function(e,t,n,r){t=ee.Concat(Oe.append([ae.HandlerView("click",n,function(){return function(){return r}}),ee.Create("href","#")],t));return ye.New(self.document.createElement("a"),t,me.TextNode(e))},me.Link=function(e,t,n){var t=ee.Concat(t),t=ee.Append(ee.Create("href","#"),t);return ye.New(me.Clickable("a",n),t,me.TextNode(e))},me.ButtonView=function(e,t,n,r){t=ee.Concat(Oe.append([ae.HandlerView("click",n,function(){return function(){return r}})],t));return ye.New(self.document.createElement("button"),t,me.TextNode(e))},me.Button=function(e,t,n){t=ee.Concat(t);return ye.New(me.Clickable("button",n),t,me.TextNode(e))},me.Clickable=function(e,t){e=self.document.createElement(e);return e.addEventListener("click",function(e){return e.preventDefault(),t()},!1),e},me.CheckBoxGroup=function(e,n,t){function r(e){return He.Equals(n,e)}return me.CheckBox(e,I.Lens(t,function(e){return De.exists(r,e)},function(e,t){return t?De.exists(function(e){return He.Equals(n,e)},e)?e:new De.T({$:1,$0:n,$1:e}):De.filter(function(e){return!He.Equals(n,e)},e)}))},me.CheckBox=function(e,t){return me.InputInternal("input",function(){return Oe.append(e,[ee.Create("type","checkbox"),ae.Checked(t)])})},me.SelectDynOptional=function(e,t,n,r,u){return me.SelectDyn(e,function(e){return null!=e&&1==e.$?n(e.$0):t},S.Map(function(e){return new De.T({$:1,$0:null,$1:De.map(function(e){return{$:1,$0:e}},e)})},r),u)},me.SelectOptional=function(e,t,n,r,u){return me.Select(e,function(e){return null!=e&&1==e.$?n(e.$0):t},new De.T({$:1,$0:null,$1:De.map(function(e){return{$:1,$0:e}},r)}),u)},me.Select=function(e,n,t,r){return me.SelectImpl(e,n,function(e){return e[0]=t,me.Concat(De.mapi(function(e,t){return me.Element("option",De.ofArray([ee.Create("value",N.String(e))]),De.ofArray([me.TextNode(n(t))]))},t))},r)},me.SelectDyn=function(e,n,r,t){return me.SelectImpl(e,n,function(t){return me.Convert(function(e){return t=e[0],e=e[1],me.Element("option",De.ofArray([ee.Create("value",N.String(t))]),De.ofArray([me.TextNode(n(e))]));var t},S.Map(function(e){return t[0]=e,Oe.mapi(function(e,t){return[e,t]},e)},r))},t)},me.SelectImpl=function(e,t,n,r){var u,i,o;function a(e,t){var n;e=e,n=t,t=Oe.findIndex(function(e){return He.Equals(n,e)},u[0]),e.selectedIndex=t}return u=[De.T.Empty],i=self.document.createElement("select"),o=ae.DynamicCustom(function(t){return function(e){return a(t,e)}},r.get_View()),i.addEventListener("change",function(){r.UpdateMaybe(function(e){var t;return t=(t=i).selectedIndex,t=u[0].get_Item(t),He.Equals(e,t)?null:{$:1,$0:t}})},!1),ye.New(i,(e=ee.Append(o,ee.Concat(e)),ee.Append(ae.OnAfterRender(function(e){a(e,r.Get())}),e)),n(u))},me.InputArea=function(e,t){return me.InputInternal("textarea",function(){return Oe.append(e,[ae.Value(t)])})},me.FloatInput=function(e,t){return me.InputInternal("input",function(){return Oe.append(e,[ae.FloatValue(t),ee.Create("type","number")])})},me.FloatInputUnchecked=function(e,t){return me.InputInternal("input",function(){return Oe.append(e,[0===t.Get()?ee.Create("value","0"):ue.EmptyAttr(),ae.FloatValueUnchecked(t),ee.Create("type","number")])})},me.IntInput=function(e,t){return me.InputInternal("input",function(){return Oe.append(e,[ae.IntValue(t),ee.Create("type","number")])})},me.IntInputUnchecked=function(e,t){return me.InputInternal("input",function(){return Oe.append(e,[0===t.Get()?ee.Create("value","0"):ue.EmptyAttr(),ae.IntValueUnchecked(t),ee.Create("type","number")])})},me.PasswordBox=function(e,t){return me.InputInternal("input",function(){return Oe.append(e,[ae.Value(t),ee.Create("type","password")])})},me.Input=function(e,t){return me.InputInternal("input",function(){return Oe.append(e,[ae.Value(t)])})},me.InputInternal=function(e,t){e=self.document.createElement(e);return ye.New(e,ee.Concat(t(e)),me.get_Empty())},me.ConvertSeqVarBy=function(e,t,n){return me.Flatten(I.MapLens(e,t,n))},me.ConvertSeqBy=function(e,n,t){return me.Flatten(S.MapSeqCachedViewBy(e,function(e,t){return n(e)(t)},t))},me.ConvertSeq=function(e,t){return me.Flatten(S.MapSeqCachedView(e,t))},me.ConvertBy=function(e,t,n){return me.Flatten(S.MapSeqCachedBy(e,t,n))},me.Convert=function(e,t){return me.Flatten(S.MapSeqCached(e,t))},me.Flatten=function(e){return me.EmbedView(S.Map(me.Concat,e))},me.TextView=function(e){var t=he.CreateTextNode();return me.Mk({$:4,$0:t},S.Map(function(e){he.UpdateTextNode(t,e)},e))},me.RunReplaceById=function(e,t){var n=self.document.getElementById(e);He.Equals(n,null)?Xe.FailWith("invalid id: "+e):t.ReplaceInDom(n)},me.RunById=function(e,t){var n=self.document.getElementById(e);He.Equals(n,null)?Xe.FailWith("invalid id: "+e):me.Run(n,t)},me.Run=function(e,t){he.LinkElement(e,t.docNode),me.RunInPlace(!1,e,t)},me.RunInPlace=function(e,t,n){var r=he.CreateRunState(t,n.docNode);S.Sink(H.get_UseAnimations()||ce.BatchUpdatesEnabled()?s.StartProcessor(he.PerformAnimatedUpdate(e,r,n.docNode)):function(){he.PerformSyncUpdate(e,r,n.docNode)},n.updates)},me.RunPrependById=function(e,t){var n=self.document.getElementById(e);He.Equals(n,null)?Xe.FailWith("invalid id: "+e):me.RunPrepend(n,t)},me.RunPrepend=function(e,t){var n=self.document.createTextNode("");e.insertBefore(n,e.firstChild),me.RunBefore(n,t)},me.RunAppendById=function(e,t){var n=self.document.getElementById(e);He.Equals(n,null)?Xe.FailWith("invalid id: "+e):me.RunAppend(n,t)},me.RunAppend=function(e,t){var n=self.document.createTextNode("");e.appendChild(n),me.RunBefore(n,t)},me.RunAfterById=function(e,t){var n=self.document.getElementById(e);He.Equals(n,null)?Xe.FailWith("invalid id: "+e):me.RunAfter(n,t)},me.RunAfter=function(e,t){var n=self.document.createTextNode("");e.parentNode.insertBefore(n,e.nextSibling),me.RunBetween(e,n,t)},me.RunBeforeById=function(e,t){var n=self.document.getElementById(e);He.Equals(n,null)?Xe.FailWith("invalid id: "+e):me.RunBefore(n,t)},me.RunBefore=function(e,t){var n=self.document.createTextNode("");e.parentNode.insertBefore(n,e),me.RunBetween(n,e,t)},me.RunBetween=function(e,t,n){var r;he.LinkPrevElement(t,n.docNode),r=he.CreateDelimitedRunState(e,t,n.docNode),S.Sink(H.get_UseAnimations()||ce.BatchUpdatesEnabled()?s.StartProcessor(he.PerformAnimatedUpdate(!1,r,n.docNode)):function(){he.PerformSyncUpdate(!1,r,n.docNode)},n.updates)},me.Async=function(e){return me.EmbedView(S.MapAsync(N.id,S.Const(e)))},me.BindView=function(e,t){return me.EmbedView(S.Map(e,t))},me.EmbedView=function(e){var t=he.CreateEmbedNode();return me.Mk({$:2,$0:t},S.Map(N.ignore,S.Bind(function(e){return he.UpdateEmbedNode(t,e.docNode),e.updates},e)))},me.Verbatim=function(e){return me.Mk(f.MapTreeReduce(function(e){return He.Equals(e.nodeType,nt.TEXT_NODE)?{$:5,$0:e}:{$:1,$0:he.CreateElemNode(e,ue.EmptyAttr(),null)}},null,function(e,t){return{$:0,$0:e,$1:t}},A.ChildrenArray(A.ParseHTMLIntoFakeRoot(e))),S.Const())},me.StaticProxy=function(e){return ye.New(e,ue.EmptyAttr(),me.get_Empty())},me.TextNode=function(e){return me.Mk({$:5,$0:self.document.createTextNode(e)},S.Const())},me.get_Empty=function(){return me.Mk(null,S.Const())},me.Concat=function(e){e=f.ofSeqNonCopying(e);return f.TreeReduce(me.get_Empty(),me.Append,e)},me.Append=function(e,t){return me.Mk({$:0,$0:e.docNode,$1:t.docNode},S.Map2Unit(e.updates,t.updates))},me.Mk=function(e,t){return new me.New(e,t)},me.New=We.Ctor(function(e,t){o.New.call(this),this.docNode=e,this.updates=t},me),(ye=t.Elt=We.Class({SetStyle:function(e,t){this.elt.style[e]=t},HasClass:function(e){return new N.RegExp("(\\s|^)"+e+"(\\s|$)").test(this.elt.className)},GetProperty:function(e){return this.elt[e]},SetProperty:function(e,t){this.elt[e]=t},RemoveAttribute:function(e){this.elt.removeAttribute(e)},HasAttribute:function(e){return this.elt.hasAttribute(e)},GetAttribute:function(e){return this.elt.getAttribute(e)},SetAttribute:function(e,t){this.elt.setAttribute(e,t)},SetText:function(e){var t=this.docNode$1;null!=t&&1==t.$?t.$0.Children=null:null!=t&&6==t.$?(t.$0.Els=[],this.ClearHoles()):Xe.FailWith("Invalid docNode in Elt"),this.rvUpdates.set_Value(S.Const()),this.elt.textContent=e},GetText:function(){return this.elt.textContent},SetValue:function(e){this.elt.value=e},GetValue:function(){return this.elt.value},Id:function(){return this.elt.id},Html:function(){return this.elt.outerHTML},Clear:function(){var e=this.docNode$1;for(null!=e&&1==e.$?e.$0.Children=null:null!=e&&6==e.$?(e.$0.Els=[],this.ClearHoles()):Xe.FailWith("Invalid docNode in Elt"),this.rvUpdates.set_Value(S.Const());this.elt.hasChildNodes();)this.elt.removeChild(this.elt.firstChild)},Prepend:function(e){var t,n=this.docNode$1;null!=n&&1==n.$?((t=n.$0).Children={$:0,$0:e.docNode,$1:t.Children},he.InsertDoc(this.elt,e.docNode,(t=this.elt.firstChild,He.Equals(t,null)?null:t))):null!=n&&6==n.$?(t=this.elt.insertBefore(self.document.createTextNode(""),this.elt.firstChild),n=he.InsertBeforeDelim(t,e.docNode),this.AddHole(se.New(ue.Empty(this.elt),e.docNode,{$:1,$0:[n,t]},this.elt,d.Int(),null))):Xe.FailWith("Invalid docNode in Elt"),this.rvUpdates.set_Value(S.Map2Unit(this.rvUpdates.c,e.updates))},Append:function(e){var t,n=this.docNode$1;null!=n&&1==n.$?((t=n.$0).Children={$:0,$0:t.Children,$1:e.docNode},he.InsertDoc(this.elt,e.docNode,null)):null!=n&&6==n.$?(t=this.elt.appendChild(self.document.createTextNode("")),n=he.InsertBeforeDelim(t,e.docNode),this.AddHole(se.New(ue.Empty(this.elt),e.docNode,{$:1,$0:[n,t]},this.elt,d.Int(),null))):Xe.FailWith("Invalid docNode in Elt"),this.rvUpdates.set_Value(S.Map2Unit(this.rvUpdates.c,e.updates))},ToUpdater:function(){var e;return new ve.New(null!=(e=this.docNode$1)&&1==e.$?We.DeleteEmptyFields({Els:[this.elt],Dirty:!0,Holes:[],Attrs:[[this.elt,e.$0.Attr]],Render:void 0,El:{$:1,$0:this.elt}.$0},["Render","El"]):null!=e&&6==e.$?e.$0:Xe.FailWith("Invalid docNode in Elt"),this.updates$1,this.elt,this.rvUpdates,I.Create$1([]))},OnAfterRenderView:function(e,t){var n=this,r=d.Id();return this.Append(me.BindView(function(e){return n.elt[r]=e,me.get_Empty()},e)),this["OnAfterRender'"](function(e){t(e,e[r])})},OnAfterRender:function(e){return this["OnAfterRender'"](e)},"OnAfterRender'":function(t){var e,n,r,u=this.docNode$1;return null!=u&&1==u.$?(e=u.$0,We.SetOptional(e,"Render",null!=(e=We.GetOptional(e.Render))&&1==e.$?(n=e.$0,{$:1,$0:function(e){n(e),t(e)}}):{$:1,$0:t})):null!=u&&6==u.$?(u=u.$0,We.SetOptional(u,"Render",null!=(u=We.GetOptional(u.Render))&&1==u.$?(r=u.$0,{$:1,$0:function(e){r(e),t(e)}}):{$:1,$0:t})):Xe.FailWith("Invalid docNode in Elt"),this},onView:function(e,t,n){var r=n(this.elt);return this.elt.addEventListener(e,function(e){return S.Get(r(e),t)},!1),this},on:function(e,t){var n=this;return this.elt.addEventListener(e,function(e){return t(n.elt,e)},!1),this},ClearHoles:function(){var e=this.docNode$1;null!=e&&6==e.$&&(e.$0.Holes=[])},AddHole:function(e){var t=this.docNode$1;null!=t&&6==t.$&&t.$0.Holes.push(e)}},me,ye)).TreeNode=function(e,t){var n;return n=M.Create(t),new ye.New$1({$:6,$0:e},S.Map2Unit((t=Ue.map(function(e){return ue.Updates(e[1])},e.Attrs),f.TreeReduce(S.Const(),S.Map2Unit,t)),n.v),Ue.get(e.Els,0),n)},ye.New=function(e,t,n){t=he.CreateElemNode(e,t,n.docNode),n=M.Create(n.updates);return new ye.New$1({$:1,$0:t},S.Map2Unit(ue.Updates(t.Attr),n.v),e,n)},ye.New$1=We.Ctor(function(e,t,n,r){me.New.call(this,e,t),this.docNode$1=e,this.updates$1=t,this.elt=n,this.rvUpdates=r},ye),(ve=te.EltUpdater=We.Class({ClearHoles:function(){this.origHoles=[],this.treeNode.Holes=[],this.holeUpdates.Set([])},AddHole:function(e){this.origHoles.push(e),this.treeNode.Holes=this.treeNode.Holes.concat([e])},RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles,this.holeUpdates.Set([])},RemoveUpdated:function(e){var t;null!=(e=e.docNode)&&1==e.$?(t=e.$0.ElKey,this.treeNode.Holes=Ue.filter(function(e){return e.ElKey!==t},this.treeNode.Holes),this.holeUpdates.Set(Ue.filter(function(e){return e[0]!==t},this.holeUpdates.Get()))):Xe.FailWith("DocUpdater.RemoveUpdated expects a single element node")},AddUpdated:function(e){var t,n=e.docNode;null!=n&&1==n.$?(t=n.$0,this.treeNode.Holes=this.treeNode.Holes.concat([t]),(n=this.holeUpdates.Get()).push([t.ElKey,e.updates]),this.holeUpdates.Set(n)):Xe.FailWith("DocUpdater.AddUpdated expects a single element node")}},ye,ve)).New=We.Ctor(function(e,t,n,r,u){var i,o,a;function l(e){return e[1]}ye.New$1.call(this,{$:6,$0:e},S.Map2Unit(t,(t=u.get_View(),S.BindInner((i=function(e){return Ue.map(l,e)},a=S.Const(),o=function(e){return f.TreeReduce(a,S.Map2Unit,e)},function(e){return o(i(e))}),t))),n,r),this.treeNode=e,this.holeUpdates=u,this.origHoles=this.treeNode.Holes},ve),Ce.$cctor=function(){Ce.$cctor=N.ignore,Ce.BatchUpdatesEnabled=!0},we.failNotLoaded=function(e){Ke.warn("Instantiating non-loaded template",e)},we.fill=function(e,t,n){for(;;){if(!e.hasChildNodes())return null;n=t.insertBefore(e.lastChild,n)}},we.fillTextHole=function(e,t,n){e=e.querySelector("[ws-replace]");return He.Equals(e,null)?(Ke.warn("Filling non-existent text hole",n),null):(e.parentNode.replaceChild(self.document.createTextNode(t),e),{$:1,$0:e.getAttribute("ws-replace")})},we.removeHolesExcept=function(e,o){function t(t){ge.foreachNotPreserved(e,"["+t+"]",function(e){o.Contains(e.getAttribute(t))||e.removeAttribute(t)})}t("ws-attr"),t("ws-onafterrender"),t("ws-var"),ge.foreachNotPreserved(e,"[ws-hole]",function(e){if(!o.Contains(e.getAttribute("ws-hole")))for(e.removeAttribute("ws-hole");e.hasChildNodes();)e.removeChild(e.lastChild)}),ge.foreachNotPreserved(e,"[ws-replace]",function(e){o.Contains(e.getAttribute("ws-replace"))||e.parentNode.removeChild(e)}),ge.foreachNotPreserved(e,"[ws-on]",function(e){e.setAttribute("ws-on",Pe.concat(" ",Ue.filter(function(e){return o.Contains(Ue.get(Pe.SplitChars(e,[":"],1),1))},Pe.SplitChars(e.getAttribute("ws-on"),[" "],1))))}),ge.foreachNotPreserved(e,"[ws-attr-holes]",function(e){for(var t,n,r=Pe.SplitChars(e.getAttribute("ws-attr-holes"),[" "],1),u=0,i=r.length-1;u<=i;u++)t=Ue.get(r,u),e.setAttribute(t,(n=new N.RegExp(ge.TextHoleRE(),"g"),e.getAttribute(t).replace(n,function(e,t){return o.Contains(t)?e:""})))})},we.fillInstanceAttrs=function(e,t){var n,r,u,i,o;if(we.convertAttrs(t),n=t.nodeName.toLowerCase(),r=e.querySelector("[ws-attr="+n+"]"),He.Equals(r,null))Ke.warn("Filling non-existent attr hole",n);else for(r.removeAttribute("ws-attr"),u=0,i=t.attributes.length-1;u<=i;u++)"class"===(o=t.attributes.item(u)).name&&r.hasAttribute("class")?r.setAttribute("class",r.getAttribute("class")+" "+o.nodeValue):r.setAttribute(o.name,o.nodeValue)},we.mapHoles=function(e,i){function t(r){ge.foreachNotPreserved(e,"["+r+"]",function(e){var t=null,n=[i.TryGetValue(e.getAttribute(r).toLowerCase(),{get:function(){return t},set:function(e){t=e}}),t];n[0]&&e.setAttribute(r,n[1])})}t("ws-hole"),t("ws-replace"),t("ws-attr"),t("ws-onafterrender"),t("ws-var"),ge.foreachNotPreserved(e,"[ws-on]",function(e){e.setAttribute("ws-on",Pe.concat(" ",Ue.map(function(e){var t=Pe.SplitChars(e,[":"],1),n=null,r=[i.TryGetValue(Ue.get(t,1),{get:function(){return n},set:function(e){n=e}}),n];return r[0]?Ue.get(t,0)+":"+r[1]:e},Pe.SplitChars(e.getAttribute("ws-on"),[" "],1))))}),ge.foreachNotPreserved(e,"[ws-attr-holes]",function(e){for(var t,n=Pe.SplitChars(e.getAttribute("ws-attr-holes"),[" "],1),r=0,u=n.length-1;r<=u;r++)t=void 0,t=Ue.get(n,r),e.setAttribute(t,We.Curried3(Oe.fold)(function(e,t){return t=Xe.KeyValue(t),e.replace(new N.RegExp("\\${"+t[0]+"}","ig"),"${"+t[1]+"}")})(e.getAttribute(t))(i))})},we.convertTextNode=function(e){for(var t,n,r=0,u=e.textContent,i=new N.RegExp(ge.TextHoleRE(),"g");null!==(n=i.exec(u));)e.parentNode.insertBefore(self.document.createTextNode(rt.string(u,{$:1,$0:r},{$:1,$0:i.lastIndex-Ue.get(n,0).length-1})),e),r=i.lastIndex,(t=self.document.createElement("span")).setAttribute("ws-replace",Ue.get(n,1).toLowerCase()),e.parentNode.insertBefore(t,e);i.lastIndex=0,e.textContent=rt.string(u,{$:1,$0:r},null)},we.convertAttrs=function(n){var e,t,r,u,i,o,a,l;function c(e){var t=n.getAttribute(e);null!==t&&n.setAttribute(e,t.toLowerCase())}for(t=[],r=[],u=[],i=0,o=(e=n.attributes).length-1;i<=o;i++)a=e.item(i),Pe.StartsWith(a.nodeName,"ws-on")&&"ws-onafterrender"!==a.nodeName&&"ws-on"!==a.nodeName?(t.push(a.nodeName),r.push(rt.string(a.nodeName,{$:1,$0:"ws-on".length},null)+":"+a.nodeValue.toLowerCase())):!Pe.StartsWith(a.nodeName,"ws-")&&new N.RegExp(ge.TextHoleRE()).test(a.nodeValue)&&(a.nodeValue=(l=new N.RegExp(ge.TextHoleRE(),"g"),a.nodeValue.replace(l,function(e,t){return"${"+t.toLowerCase()+"}"})),u.push(a.nodeName));0!=r.length&&n.setAttribute("ws-on",Pe.concat(" ",r)),0!=u.length&&n.setAttribute("ws-attr-holes",Pe.concat(" ",u)),c("ws-hole"),c("ws-replace"),c("ws-attr"),c("ws-onafterrender"),c("ws-var"),Ue.iter(function(e){n.removeAttribute(e)},t)},ge.GetOrLoadTemplate=function(e,t,n,r){return ge.LoadLocalTemplates(""),ge.PrepareTemplate(e,t,n),ge.NamedTemplate(e,t,r)},ge.NamedTemplate=function(e,t,n){var r=null,e=[ge.LoadedTemplateFile(e).TryGetValue(null==t?"":t.$0,{get:function(){return r},set:function(e){r=e}}),r];return e[0]?ge.ChildrenTemplate(e[1].cloneNode(!0),n):(Ke.warn("Local template doesn't exist",t),me.get_Empty())},ge.RunFullDocTemplate=function(e){var t;return null==ge.RenderedFullDocTemplate()?(ge.LoadLocalTemplates(""),ge.PrepareTemplateStrict("",null,self.document.body,null),t=ge.ChildrenTemplate(self.document.body,e),e=self.document.body,me.RunInPlace(!0,e,t),ge.set_RenderedFullDocTemplate({$:1,$0:t=t}),t):ge.RenderedFullDocTemplate().$0},ge.RenderedFullDocTemplate=function(){return Se.$cctor(),Se.RenderedFullDocTemplate},ge.set_RenderedFullDocTemplate=function(e){Se.$cctor(),Se.RenderedFullDocTemplate=e},ge.LoadLocalTemplates=function(e){ge.LocalTemplatesLoaded()||(ge.set_LocalTemplatesLoaded(!0),ge.LoadNestedTemplates(self.document.body,"")),ge.LoadedTemplates().set_Item(e,ge.LoadedTemplateFile(""))},ge.LoadNestedTemplates=function(e,r){var u,i,t,n,o,a,l,c,s,f,d,$,p;function h(e){var t,n;u.ContainsKey(e)||(n=null,(t=[i.TryGetValue(e,{get:function(){return n},set:function(e){n=e}}),n])[0]?(p.Add(e),i.Remove(e),ge.PrepareTemplateStrict(r,{$:1,$0:e},t[1],{$:1,$0:h})):Ke.warn(p.Contains(e)?"Encountered loop when instantiating "+e:"Local template does not exist: "+e))}for(u=ge.LoadedTemplateFile(r),i=new Ye.New$5,n=0,o=(t=e.querySelectorAll("[ws-template]")).length-1;n<=o;n++)l=(a=t[n]).getAttribute("ws-template").toLowerCase(),a.removeAttribute("ws-template"),i.set_Item(l,ge.FakeRootSingle(a));for(s=0,f=(c=e.querySelectorAll("[ws-children-template]")).length-1;s<=f;s++)$=(d=c[s]).getAttribute("ws-children-template").toLowerCase(),d.removeAttribute("ws-children-template"),i.set_Item($,ge.FakeRoot(d));for(p=new qe.New$3;0<i.count;)h(Oe.head(i.get_Keys()))},ge.PrepareTemplate=function(e,t,n){ge.LoadedTemplateFile(e).ContainsKey(null==t?"":t.$0)||ge.PrepareTemplateStrict(e,t,n(),null)},ge.PrepareSingleTemplate=function(t,n,e){var r=ge.FakeRootSingle(e);return function(e){ge.PrepareTemplateStrict(t,n,r,e)}},ge.PrepareTemplateStrict=function(g,e,t,w){function n(e,t){var n,r,u,i,o,a,l,c,s,f,d,$,p,h,m,y,v,C;for(;;)switch(e){case 0:if(null===t)return null;m=t.nextSibling,He.Equals(t.nodeType,nt.TEXT_NODE)?we.convertTextNode(t):He.Equals(t.nodeType,nt.ELEMENT_NODE)&&S(t),t=m;break;case 1:if(r=(u=-1===(m=(u=rt.string(t.nodeName,{$:1,$0:3},null).toLowerCase()).indexOf("."))?[g,u]:[rt.string(u,null,{$:1,$0:m-1}),rt.string(u,{$:1,$0:m+1},null)])[1],""===(m=u[0])||ge.LoadedTemplates().ContainsKey(m)){if(""===m&&null!=w&&w.$0(r),(u=ge.LoadedTemplates().get_Item(m)).ContainsKey(r)){for(i=u.get_Item(r).cloneNode(!0),o=new qe.New$3,a=new Ye.New$5,c=0,s=(l=t.attributes).length-1;c<=s;c++)f=l.item(c).name.toLowerCase(),a.set_Item(f,""===(d=l.item(c).nodeValue)?f:d.toLowerCase()),o.Add(f)||Ke.warn("Hole mapped twice",f);for($=0,p=t.childNodes.length-1;$<=p;$++)h=t.childNodes[$],He.Equals(h.nodeType,nt.ELEMENT_NODE)&&(o.Add(h.nodeName.toLowerCase())||Ke.warn("Hole filled twice",r));if((m=1===t.childNodes.length&&He.Equals(t.firstChild.nodeType,nt.TEXT_NODE))&&(u=we.fillTextHole(i,t.firstChild.textContent,r),function(t){return function(e){null!=e&&t(e.$0)}}((n=function(t){return function(e){return t.Add(e)}}(o),function(e){n(e)}))(u)),we.removeHolesExcept(i,o),!m)for(y=0,v=t.childNodes.length-1;y<=v;y++)C=t.childNodes[y],He.Equals(C.nodeType,nt.ELEMENT_NODE)&&(C.hasAttributes()?we.fillInstanceAttrs(i,C):function(e,o){var a,t;function n(e,t){var n;if("title"===a&&o.hasChildNodes())for(n=A.ParseHTMLIntoFakeRoot(o.textContent),o.removeChild(o.firstChild);n.hasChildNodes();)o.appendChild(n.firstChild);return S(o),we.fill(o,e,t)}{if(a=o.nodeName.toLowerCase(),ge.foreachNotPreserved(e,"[ws-attr-holes]",function(e){for(var t,n,r=Pe.SplitChars(e.getAttribute("ws-attr-holes"),[" "],1),u=0,i=r.length-1;u<=i;u++)t=Ue.get(r,u),e.setAttribute(t,(n=new N.RegExp("\\${"+a+"}","ig"),e.getAttribute(t).replace(n,o.textContent)))}),t=e.querySelector("[ws-hole="+a+"]"),He.Equals(t,null))return e=e.querySelector("[ws-replace="+a+"]"),He.Equals(e,null)||(n(e.parentNode,e),e.parentNode.removeChild(e));for(;t.hasChildNodes();)t.removeChild(t.lastChild);t.removeAttribute("ws-hole"),n(t,null)}}(i,C));return we.mapHoles(i,a),we.fill(i,t.parentNode,t),void t.parentNode.removeChild(t)}return we.failNotLoaded(r)}return we.failNotLoaded(r)}}function S(e){e.hasAttribute("ws-preserve")||(Pe.StartsWith(e.nodeName.toLowerCase(),"ws-")?n(1,e):(we.convertAttrs(e),r(e.firstChild)))}function r(e){return n(0,e)}e=(null==e?"":e.$0).toLowerCase(),ge.LoadedTemplateFile(g).set_Item(e,t),t.hasChildNodes()&&(function(e){for(var t,n,r;;)if(t=e.querySelector("[ws-template]"),He.Equals(t,null)){if(r=e.querySelector("[ws-children-template]"),He.Equals(r,null))return;n=r.getAttribute("ws-children-template"),r.removeAttribute("ws-children-template"),ge.PrepareTemplateStrict(g,{$:1,$0:n},r,null)}else r=t.getAttribute("ws-template"),ge.PrepareSingleTemplate(g,{$:1,$0:r},t)(null)}(t),r(t.firstChild))},ge.FakeRootSingle=function(e){var t,n,r;return e.removeAttribute("ws-template"),null!==(t=e.getAttribute("ws-replace"))&&(e.removeAttribute("ws-replace"),n=e.parentNode,He.Equals(n,null)||((r=self.document.createElement(e.tagName)).setAttribute("ws-replace",t),n.replaceChild(r,e))),(r=self.document.createElement("div")).appendChild(e),r},ge.FakeRoot=function(e){for(var t=self.document.createElement("div");e.hasChildNodes();)t.appendChild(e.firstChild);return t},ge.ChildrenTemplate=function(e,t){var n=ge.InlineTemplate(e,Oe.append(t,ge.GlobalHoles().get_Values())),e=n[1],t=n[0],n=t.Els;return!He.Equals(n,null)&&1===n.length&&Ue.get(n,0)instanceof nt&&He.Equals(Ue.get(n,0).nodeType,nt.ELEMENT_NODE)&&(Ue.get(n,0),1)?ye.TreeNode(t,e):me.Mk({$:6,$0:t},e)},ge.InlineTemplate=function(e,t){var o,n,a,l,r,u,h,i,c;function m(e,t){var n,t=ue.Insert(e,t);return l.push(ue.Updates(t)),r.push([e,t]),null==(t=We.GetOptional(t.OnAfterRender))?null:(n=t.$0,void u.push(function(){n(e)}))}function s(e){var t=null,n=[h.TryGetValue(e,{get:function(){return t},set:function(e){t=e}}),t];return n[0]?0==n[1].$?{$:1,$0:n[1].$1}:1==n[1].$?{$:1,$0:me.TextNode(n[1].$1)}:2==n[1].$?{$:1,$0:me.TextView(n[1].$1)}:8==n[1].$?{$:1,$0:me.TextView(n[1].$1.get_View())}:9==n[1].$?{$:1,$0:me.TextView(S.Map(N.String,n[1].$1.get_View()))}:10==n[1].$?{$:1,$0:me.TextView(S.Map(function(e){return e.get_Input()},n[1].$1.get_View()))}:11==n[1].$?{$:1,$0:me.TextView(S.Map(N.String,n[1].$1.get_View()))}:12==n[1].$?{$:1,$0:me.TextView(S.Map(function(e){return e.get_Input()},n[1].$1.get_View()))}:13==n[1].$?{$:1,$0:me.TextView(S.Map(N.String,n[1].$1.get_View()))}:(Ke.warn("Content hole filled with attribute data",e),null):null}a=[],l=[],r=[],u=[],h=new Ye.New$5,i=Be.Get(t);try{for(;i.MoveNext();)c=i.Current(),h.set_Item(c.$0,c)}finally{"object"==typeof i&&"Dispose"in i&&i.Dispose()}return o=A.ChildrenArray(e),ge.foreachNotPreserved(e,"[ws-hole]",function(e){var t=e.getAttribute("ws-hole");for(e.removeAttribute("ws-hole");e.hasChildNodes();)e.removeChild(e.lastChild);null!=(t=s(t))&&1==t.$&&(t=t.$0,he.LinkElement(e,t.docNode),a.push(se.New(ue.Empty(e),t.docNode,null,e,d.Int(),null)),l.push(t.updates))}),ge.foreachNotPreserved(e,"[ws-replace]",function(t){var e,n,r,u,i=s(t.getAttribute("ws-replace"));null!=i&&1==i.$&&(e=i.$0,n=t.parentNode,r=self.document.createTextNode(""),n.replaceChild(r,t),u=he.InsertBeforeDelim(r,e.docNode),null!=(i=Ue.tryFindIndex(function(e){return t===e},o))&&Ue.set(o,i.$0,e.docNode),a.push(se.New(ue.Empty(n),e.docNode,{$:1,$0:[u,r]},n,d.Int(),null)),l.push(e.updates))}),ge.foreachNotPreserved(e,"[ws-attr]",function(e){var t,n,r=e.getAttribute("ws-attr");e.removeAttribute("ws-attr"),n=null,(t=[h.TryGetValue(r,{get:function(){return n},set:function(e){n=e}}),n])[0]&&(3==t[1].$?m(e,t[1].$1):Ke.warn("Attribute hole filled with non-attribute data",r))}),ge.foreachNotPreserved(e,"[ws-on]",function(e){m(e,ee.Concat(Ue.choose(function(e){var t=Pe.SplitChars(e,[":"],1),n=null,e=[h.TryGetValue(Ue.get(t,1),{get:function(){return n},set:function(e){n=e}}),n];return e[0]?4==e[1].$?{$:1,$0:ae.Handler(Ue.get(t,0),e[1].$1)}:5==e[1].$?{$:1,$0:ee.Handler(Ue.get(t,0),e[1].$1)}:(Ke.warn("Event hole on"+Ue.get(t,0)+" filled with non-event data",Ue.get(t,1)),null):null},Pe.SplitChars(e.getAttribute("ws-on"),[" "],1)))),e.removeAttribute("ws-on")}),ge.foreachNotPreserved(e,"[ws-onafterrender]",function(e){var t=e.getAttribute("ws-onafterrender"),n=null,r=[h.TryGetValue(t,{get:function(){return n},set:function(e){n=e}}),n];r[0]&&(6==r[1].$||7==r[1].$?(e.removeAttribute("ws-onafterrender"),m(e,ae.OnAfterRender(r[1].$1))):Ke.warn("onafterrender hole filled with non-onafterrender data",t))}),ge.foreachNotPreserved(e,"[ws-var]",function(e){var t,n,r=e.getAttribute("ws-var");e.removeAttribute("ws-var"),n=null,(t=[h.TryGetValue(r,{get:function(){return n},set:function(e){n=e}}),n])[0]&&(8==t[1].$?m(e,ae.Value(t[1].$1)):9==t[1].$?m(e,ae.Checked(t[1].$1)):10==t[1].$?m(e,ae.IntValue(t[1].$1)):11==t[1].$?m(e,ae.IntValueUnchecked(t[1].$1)):12==t[1].$?m(e,ae.FloatValue(t[1].$1)):13==t[1].$?m(e,ae.FloatValueUnchecked(t[1].$1)):Ke.warn("Var hole filled with non-Var data",r))}),ge.foreachNotPreserved(e,"[ws-attr-holes]",function(f){var d,e,$=new N.RegExp(ge.TextHoleRE(),"g"),p=Pe.SplitChars(f.getAttribute("ws-attr-holes"),[" "],1);for(f.removeAttribute("ws-attr-holes"),d=0,e=p.length-1;d<=e;d++)!function(){for(var e,r,t,n,u,i,o,a=Ue.get(p,d),l=f.getAttribute(a),c=0,s=[];null!==(o=$.exec(l));)i=rt.string(l,{$:1,$0:c},{$:1,$0:$.lastIndex-Ue.get(o,0).length-1}),c=$.lastIndex,s.push([i,Ue.get(o,1)]);e=rt.string(l,{$:1,$0:c},null),$.lastIndex=0,e=Ue.foldBack(function(e,t){return u=e[0],i=e[1],function(e){var t=e[0],n=e[1],r=null,e=[h.TryGetValue(i,{get:function(){return r},set:function(e){r=e}}),r],e=e[0]?1==e[1].$?{$:0,$0:e[1].$1}:2==e[1].$?{$:1,$0:e[1].$1}:8==e[1].$?{$:1,$0:e[1].$1.get_View()}:9==e[1].$?{$:1,$0:S.Map(N.String,e[1].$1.get_View())}:10==e[1].$?{$:1,$0:S.Map(function(e){return e.get_Input()},e[1].$1.get_View())}:11==e[1].$?{$:1,$0:S.Map(N.String,e[1].$1.get_View())}:12==e[1].$?{$:1,$0:S.Map(function(e){return e.get_Input()},e[1].$1.get_View())}:13==e[1].$?{$:1,$0:S.Map(N.String,e[1].$1.get_View())}:(Ke.warn("Attribute value hole filled with non-text data",i),{$:0,$0:""}):{$:0,$0:""};return 1==e.$?[u,new De.T({$:1,$0:""===t?e.$0:S.Map(function(e){return e+t},e.$0),$1:n})]:[u+e.$0+t,n]}(t);var u,i},s,[e,De.T.Empty]),m(f,1==e[1].$?1==e[1].$1.$?1==e[1].$1.$1.$?0==e[1].$1.$1.$1.$?(r=e[0],ae.Dynamic(a,S.Map3(function(e,t,n){return r+e+t+n},e[1].$0,e[1].$1.$0,e[1].$1.$1.$0))):(t=e[0],ae.Dynamic(a,S.Map(function(e){return t+Pe.concat("",e)},S.Sequence(e[1])))):(n=e[0],ae.Dynamic(a,S.Map2(function(e,t){return n+e+t},e[1].$0,e[1].$1.$0))):""===e[0]?ae.Dynamic(a,e[1].$0):(u=e[0],ae.Dynamic(a,S.Map(function(e){return u+e},e[1].$0))):ee.Create(a,e[0]))}()}),[We.DeleteEmptyFields({Els:o,Dirty:!0,Holes:a,Attrs:r,Render:(e=0==u.length?null:{$:1,$0:function(t){Ue.iter(function(e){e(t)},u)}})?e.$0:void 0,El:(n=!He.Equals(o,null)&&1===o.length&&Ue.get(o,0)instanceof nt&&Ue.get(o,0)instanceof N.Element&&(n=Ue.get(o,0),1)?{$:1,$0:n}:null)?n.$0:void 0},["Render","El"]),f.TreeReduce(S.Const(),S.Map2Unit,l)]},ge.foreachNotPreserved=function(e,t,n){A.IterSelector(e,t,function(e){null==e.closest("[ws-preserve]")&&n(e)})},ge.TextHoleRE=function(){return Se.$cctor(),Se.TextHoleRE},ge.GlobalHoles=function(){return Se.$cctor(),Se.GlobalHoles},ge.set_GlobalHoles=function(e){Se.$cctor(),Se.GlobalHoles=e},ge.LocalTemplatesLoaded=function(){return Se.$cctor(),Se.LocalTemplatesLoaded},ge.set_LocalTemplatesLoaded=function(e){Se.$cctor(),Se.LocalTemplatesLoaded=e},ge.LoadedTemplateFile=function(e){var t=null,n=[ge.LoadedTemplates().TryGetValue(e,{get:function(){return t},set:function(e){t=e}}),t];return n[0]?n[1]:(n=new Ye.New$5,ge.LoadedTemplates().set_Item(e,n),n)},ge.LoadedTemplates=function(){return Se.$cctor(),Se.LoadedTemplates},Se.$cctor=function(){Se.$cctor=N.ignore,Se.LoadedTemplates=new Ye.New$5,Se.LocalTemplatesLoaded=!1,Se.GlobalHoles=new Ye.New$5,Se.TextHoleRE="\\${([^}]+)}",Se.RenderedFullDocTemplate=null},(Ne=t.Flow=We.Class({get_Render:function(){return this.render}},o,Ne)).New=We.Ctor(function(n){Ne.New$1.call(this,function(t){return function(e){return I.Set(t,n(e))}})},Ne),Ne.New$1=We.Ctor(function(e){o.New.call(this),this.render=e},Ne),Ne.get_Do=function(){return new Ae.New},Ne.Static=function(n){return new Ne.New$1(function(t){return function(e){return I.Set(t,n),e()}})},Ne.Define=function(e){return new Ne.New(function(t){return e(function(e){t(e)})})},Ne.Embed=function(e){var t=I.Create$1(me.get_Empty());return e.get_Render()(t)(N.ignore),me.EmbedView(t.get_View())},Ne.Return=function(t){return new Ne.New$1(function(){return function(e){return e(t)}})},Ne.Bind=function(e,r){return new Ne.New$1(function(n){return function(t){return e.get_Render()(n)(function(e){r(e).get_Render()(n)(t)})}})},Ne.Map=function(n,r){return new Ne.New$1(function(e){return function(t){return r.get_Render()(e)(function(e){t(n(e))})}})},(Ae=t.FlowBuilder=We.Class({ReturnFrom:N.id,Return:function(e){return Ne.Return(e)},Bind:function(e,t){return Ne.Bind(e,t)}},o,Ae)).New=We.Ctor(function(){o.New.call(this)},Ae),(Ie=Ee.attr=We.Class({},o,Ie)).New=We.Ctor(function(){o.New.call(this)},Ie),Me.InstallHash=function(e,t){var n=I.Create$1(void 0);return Me.InstallHashInto(n,e,t),n},Me.InstallHashInto=function(t,e,n){function r(e){return ut.Parse(n,it.FromHash(e,{$:1,$0:!0}))}function u(){return Me.getCurrentHash(r,e)}function i(e){He.Equals(t.Get(),e)||t.Set(e)}i(u()),self.addEventListener("popstate",function(){return i(u())},!1),self.addEventListener("hashchange",function(){return i(u())},!1),self.document.body.addEventListener("click",function(e){var t=Me.findLinkHref(e.target),n=null==t?null:(n=t.$0,Pe.StartsWith(n,"#")?r(n):null);return null==n?null:(i(n.$0),e.preventDefault())},!1),S.Sink(function(e){He.Equals(e,u())||(e=ut.HashLink(n,e),self.history.pushState(null,null,e))},t.get_View())},Me.getCurrentHash=function(e,t){var n=self.location.hash,e=e(n);return null==e?(function(e){e="Failed to parse route: "+ot.toSafe(e),Ke.log(e)}(n),t):e.$0},Me.Install=function(e,t){var n=I.Create$1(void 0);return Me.InstallInto(n,e,t),n},Me.InstallInto=function(t,e,n){function r(e){return ut.Parse(n,e)}function u(){return Me.getCurrent(r,e)}function i(e){He.Equals(t.Get(),e)||t.Set(e)}i(u()),self.addEventListener("popstate",function(){return i(u())},!1),self.document.body.addEventListener("click",function(e){var t=Me.findLinkHref(e.target),t=null==t?null:Me.hrefToAbsolute(t.$0),t=null==t?null:r(it.FromUrl(t.$0,null));return null==t?null:(i(t.$0),e.preventDefault())},!1),S.Sink(function(e){He.Equals(e,u())||(e=ut.Link(n,e),self.history.pushState(null,null,e))},t.get_View())},Me.findLinkHref=function(e){for(;;){if("A"===e.tagName)return at.ofObj(e.getAttribute("href"));if(e===self.document.body)return null;e=e.parentNode}},Me.hrefToAbsolute=function(e){var t;return Pe.StartsWith(e,"?")?{$:1,$0:Me.trimFragment(self.location.pathname+e)}:Pe.StartsWith(e,"#")?null:Pe.StartsWith(e,"/")?{$:1,$0:Me.trimFragment(e)}:new N.RegExp("^[a-zA-Z0-9]:").test(e)?null:(t=self.location.pathname,{$:1,$0:Me.trimFragment(rt.string(t,null,{$:1,$0:t.lastIndexOf("/")})+e)})},Me.trimFragment=function(e){var t=e.indexOf("#");return-1===t?e:rt.string(e,null,{$:1,$0:t-1})},Me.getCurrent=function(e,t){var n=self.location,n=it.FromUrl(n.pathname+n.search,null),e=e(n);return null==e?(function(e){e="Failed to parse route: "+ot.toSafe(e),Ke.log(e)}(n.ToLink()),t):e.$0},be.Append=function(e,t){return{$:0,$0:p.Append(e.$0,t.$0),$1:je.FoldBack(function(e,t,n){return n.Add(e,t)},e.$1,t.$1)}},be.FromList=function(e,t){return{$:0,$0:p.FromArray(Ue.ofList(e)),$1:t}},be.ToList=function(e){return[De.ofArray(p.ToArray(e.$0)),e.$1]},be.SameHash=function(e,t){return be.NoHash(e)===be.NoHash(t)},be.MakeHash=function(e){var t=e.$1,e=Pe.concat("/",Ue.map(function(e){return N.encodeURIComponent(e)},p.ToArray(e.$0)));return t.get_IsEmpty()?e:e+"?"+Pe.concat("&",Oe.map(function(e){e=Xe.KeyValue(e);return N.encodeURIComponent(e[0])+"="+N.encodeURIComponent(e[1])},t))},be.ParseHash=function(e){var t=be.NoHash(e),e=t.indexOf("?"),t=-1===e?[t,""]:[rt.string(t,null,{$:1,$0:e-1}),rt.string(t,{$:1,$0:e+1},null)],e=t[0];return{$:0,$0:p.FromArray(""===e?[]:Ue.map(function(e){return N.decodeURIComponent(e)},Pe.SplitChars(e,["/"],0))),$1:je.OfArray(Ue.map(function(e){var t=e.indexOf("=");return-1===t?[N.decodeURIComponent(e),""]:[N.decodeURIComponent(rt.string(e,null,{$:1,$0:t-1})),N.decodeURIComponent(rt.string(e,{$:1,$0:t+1},null))]},Pe.SplitChars(t[1],["&"],0)))}},be.NoHash=function(e){return Pe.StartsWith(e,"#")?e.substring(1):e},Te.DoLink=function(e,t){t=e.Ser(t);return be.FromList(t[0],t[1])},Te.DoRoute=function(e,t){return e.Des(be.ToList(t))},Te.InstallMap=function(r){var u;function t(){return r.Des(be.ToList(be.ParseHash(self.location.hash)))}function n(e){var t,n;t=u.Get(),n=e,He.Equals(r.Ser(t),r.Ser(n))||u.Set(e)}function e(e){return n(t())}return u=I.Create$1(t()),self.onpopstate=e,self.onhashchange=e,S.Sink(function(e){e=be.MakeHash((e=r.Ser(e),be.FromList(e[0],e[1])));be.SameHash(self.location.hash,e)||self.location.replace("#"+e)},u.get_View()),u},Fe.Install=function(e){return Te.InstallMap(e)},Fe.Create=function(t,n){return{Des:function(e){return n(e[0])},Ser:function(e){return[t(e),new Je.New([])]}}},Fe.CreateWithQuery=function(e,t){return{Des:t,Ser:e}},Ve.New=function(e,t){return{Active:e,PosV:t}},Le.New=function(e,t,n,r){return{Active:e,Left:t,Middle:n,Right:r}},Re.get_MousePressed=function(){return ke.ActivateButtonListener(),S.Apply(S.Apply(S.Apply(S.Const(We.Curried3(function(e,t,n){return e||t||n})),ke.MouseBtnSt$1().Left.get_View()),ke.MouseBtnSt$1().Middle.get_View()),ke.MouseBtnSt$1().Right.get_View())},Re.get_RightPressed=function(){return ke.ActivateButtonListener(),ke.MouseBtnSt$1().Right.get_View()},Re.get_MiddlePressed=function(){return ke.ActivateButtonListener(),ke.MouseBtnSt$1().Middle.get_View()},Re.get_LeftPressed=function(){return ke.ActivateButtonListener(),ke.MouseBtnSt$1().Left.get_View()},Re.get_Position=function(){return ke.MousePosSt$1().Active||(self.document.addEventListener("mousemove",function(e){return I.Set(ke.MousePosSt$1().PosV,[e.clientX,e.clientY])}),ke.MousePosSt$1().Active=!0),ke.MousePosSt$1().PosV.get_View()},_e.New=function(e,t,n){return{KeysPressed:e,KeyListenerActive:t,LastPressed:n}},J.IsPressed=function(t){function n(e){return e===t}return ke.ActivateKeyListener(),S.Map(function(e){return De.exists(n,e)},ke.KeyListenerState().KeysPressed.get_View())},J.get_LastPressed=function(){return ke.ActivateKeyListener(),ke.KeyListenerState().LastPressed.get_View()},J.get_KeysPressed=function(){return ke.ActivateKeyListener(),ke.KeyListenerState().KeysPressed.get_View()},ke.ActivateKeyListener=function(){return xe.$cctor(),xe.ActivateKeyListener},ke.KeyListenerState=function(){return xe.$cctor(),xe.KeyListenerState},ke.ActivateButtonListener=function(){return xe.$cctor(),xe.ActivateButtonListener},ke.MouseBtnSt$1=function(){return xe.$cctor(),xe.MouseBtnSt},ke.MousePosSt$1=function(){return xe.$cctor(),xe.MousePosSt},xe.$cctor=function(){function t(e,t){e=e.button;return 0===e?I.Set(ke.MouseBtnSt$1().Left,t):1===e?I.Set(ke.MouseBtnSt$1().Middle,t):2===e?I.Set(ke.MouseBtnSt$1().Right,t):null}xe.$cctor=N.ignore,xe.MousePosSt=Ve.New(!1,I.Create$1([0,0])),xe.MouseBtnSt=Le.New(!1,I.Create$1(!1),I.Create$1(!1),I.Create$1(!1)),xe.ActivateButtonListener=ke.MouseBtnSt$1().Active?null:(ke.MouseBtnSt$1().Active=!0,self.document.addEventListener("mousedown",function(e){return t(e,!0)}),self.document.addEventListener("mouseup",function(e){return t(e,!1)})),xe.KeyListenerState=_e.New(I.Create$1(De.T.Empty),!1,I.Create$1(-1)),xe.ActivateKeyListener=ke.KeyListenerState().KeyListenerActive?null:(ke.KeyListenerState().KeyListenerActive=!0,self.document.addEventListener("keydown",function(e){var t=e.which,n=null===t?e.keyCode:t;return I.Set(ke.KeyListenerState().LastPressed,n),t=ke.KeyListenerState().KeysPressed.Get(),De.exists(function(e){return e===n},t)?null:ke.KeyListenerState().KeysPressed.Set(De.append(t,De.ofArray([n])))}),self.document.addEventListener("keyup",function(e){var t,n;function r(e){return e!==n}return t=e.which,n=null===t?e.keyCode:t,I.Update(ke.KeyListenerState().KeysPressed,function(e){return De.filter(r,e)})}))}}();